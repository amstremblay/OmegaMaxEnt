%-------------------------------------------------------------------------------
%User guide for omega_maxent
%Dominic Bergeron
%-------------------------------------------------------------------------------

%Définition du type (classe) de document
%-------------------------------------------------------------------------------
\documentclass[12pt,letterpaper,oneside,titlepage]{article}   
%-------------------------------------------------------------------------------

% Packages utiles
%-------------------------------------------------------------------------------
\usepackage{array}
%\usepackage[french]{babel}  % Utilise l'hyphenation francaise
\usepackage[dvips]{graphicx}    % Pour l'importation de graphiques EPS
\usepackage{amsmath}        % Utilise les fonctions mathematiques avancees
\usepackage{amssymb}
\usepackage{times}      % Utilise le font Times plutot que le font standard de LaTeX (Computer Modern). Simplifie les fichiers PDF.
%\usepackage{arial}
%\usepackage{boxedminipage} % Pour faire des blocs d'equations dans une boite
%\usepackage{lscape}        % Pour pouvoir mettre des pages en landscape (horizontal) 
%\usepackage{float}     % Pour faire des tableaux multipages
%\usepackage[ansinew]{inputenc}  % Pour que LaTeX reconnaisse les caracteres etendus (accents)
%\usepackage{epsfig}
%\usepackage{subfigure}
\usepackage{t1enc}      %césure des mots accentués
\usepackage{setspace}
\usepackage[pdftex=true]{hyperref}
%\usepackage{feynmp}
%-------------------------------------------------------------------------------


%Définition des marges et espacements
%-------------------------------------------------------------------------------

%\setlength{\parindent}{0in}

\setlength{\voffset}{-0.465in}
\setlength{\headheight}{12pt}
\setlength{\headsep}{0.424in}
\setlength{\topmargin}{0in}

\setlength{\hoffset}{0.2in}
\setlength{\oddsidemargin}{0in}

%%\setlength{\marginparwidth}{1in}
%%\setlength{\evensidemargin}{0.5in}

\setlength{\textwidth}{5.84in}
\setlength{\textheight}{8.5in}
\linespread{1.5}
\setlength{\parskip}{0.1in}
\setlength{\footskip}{0.3in}

%%\setlength{\subfigcapskip}{0pt}
%%\setlength{\subfigtopskip}{15pt}
%-------------------------------------------------------------------------------

%numérote les équations par numéro de section
%-------------------------------------------------------------------------------
\numberwithin{equation}{section}    
%-------------------------------------------------------------------------------

%Nouvelles commandes pour l'affichage de symboles mathématiques
%-------------------------------------------------------------------------------
\newcommand\diverg{\nabla\cdot}
\renewcommand{\d}[2]{\frac{#1}{#2}}
\newcommand{\pd}{\partial}
\newcommand{\bra}[1]{\langle #1|}
\newcommand{\ket}[1]{| #1\rangle}
\newcommand{\mn}[1]{\left\langle #1 \right\rangle}
\newcommand{\bk}[2]{\left\langle #1 | #2 \right\rangle}
\newcommand{\derPrem}[2]{\frac{d#1}{d#2}}
\newcommand{\derSec}[2]{\frac{d^2#1}{d#2^2}}
%-------------------------------------------------------------------------------

\title{\textit{$\Omega$MaxEnt} user guide}
\author{Dominic Bergeron}
%\hyphenation{}

\begin{document}

\pagenumbering{arabic}

\maketitle

\clearpage

\tableofcontents

\clearpage

\section{Introduction}

\subsection{Overview}

This is the user guide for the program \textit{$\Omega$MaxEnt}, a tool to perform the analytic continuation of Matsubara data using a maximum entropy approach. It can treat fermionic or bosonic data, given as a function of Matsubara frequency or imaginary time, with either a diagonal or general covariance matrix. It also sufficiently automatized to perform batch calculations with large data sets. For the fermionic case, the output is a positive spectral function $A(\omega)$ and, for the bosonic case, it is the function $\sigma(\omega)=A(\omega)/\omega$, also positive. 

Correlation functions that do not have a spectral function with a definite sign can also be obtained using the method described in appendix \ref{sec:non_def_sign_sf}. Examples of application of that method can be found in Refs. \cite{Reymbaut:2015} and \cite{Reymbaut_Gagnon_2017}.

A specific feature of \textit{$\Omega$MaxEnt} is the method it uses to find the optimal value of the entropy weight parameter $\alpha$. It does not use either the \textit{classic} approach or Bryan's, but instead locates the range of $\alpha$ where only information is fitted and the range where noise is also fitted. The optimal value is then chosen in the crossover between the two regimes. The program also offers useful graphical diagnostic tools for assessing the quality of the results.

In addition, the program uses a cubic spline to model the spectral function and uses the Matsubara frequency spectral representation of the Green function instead of the imaginary time version. Those two choices allow to compute the Green function corresponding to a given spectral function with high accuracy by a piecewise analytical integral. The use of a non-uniform grid, combined with a hybrid spline cubic in frequency $\omega$ at low $|\omega|$ and cubic in $1/(\omega-\omega_{0\mu})$ (see section \ref{sec:user-defined_grid} for more details) at high $|\omega|$, and contraints on moments instead of a high Matsubara frequency cutoff also allows to improve calculation efficiency without losing accuracy. Basically, the code is optimized to ensure that the errors in the results comes from the errors in the data and not from numerical approximations.

You can obtain results by providing only a data file name to the program. It is however highly recommended to provide also errors (standard deviation or covariance matrix) if reliable estimates are available. You can also further improve the results by providing more information, like some known moments of the spectral function, a default model, or by providing a frequency grid adapted to the expected structures of the spectral function.

The next two subsection of this introduction present the basic theoretical aspects necessary to understand what you are doing when using this program. Then section \ref{sec:step_by_step} describes how to use \textit{$\Omega$MaxEnt} step-by-step. You can execute the program already at the end of subsection \ref{sec:set_input_data} to get some preliminary results. The following subsections give you the possibility to use more information you might possess to improve the result. Some explanations on how the program works and advices on how to interpret and improve the results are given at the end of the section. Lists of the output figures and the output files are given in subsections \ref{sec:out_figs} and \ref{sec:out_files}, respectively. Finally, section \ref{sec:list_params} presents a list of all the input parameters with a short description of each one. 

A detailed description of the algorithms and also benchmarks are presented in Ref. \cite{Bergeron_Tremblay_maxent_PRE} or \cite{MaxEnt_Bergeron_Tremblay_arxiv}. The latest version's source code and binaries are available on the program's web page \cite{OmegaMaxEnt_url}.

For simplicity, throughout this guide, the Matsubara data is referred to as the ``Green function'' $G$, but the data can be a correlation function, a self-energy or any Matsubara function satisfying the conditions given in the next section. The result obtained with the program is also referred to as the spectral function $A$, although for bosonic data, it is actually $\sigma(\omega)=A(\omega)/\omega$. 

Feel free to use the results obtained with the code in publications. If you do, please cite Ref. \cite{Bergeron_Tremblay_maxent_PRE}.

\subsection{Type of data accepted}\label{sec:data_types_accepted}

The program can treat data that can be expressed as
\begin{equation}\label{eq:spectr_G}
G(i\omega_n)=\int_{-\infty}^{\infty}\frac{d\omega}{2\pi}\,\frac{A(\omega)}{i\omega_n-\omega}
\end{equation}
or
\begin{equation}\label{eq:spectr_G_tau}
G(\tau)=\int_{-\infty}^{\infty} \frac{d\omega}{2\pi} \frac{e^{-\omega\tau} A(\omega)}{1\pm e^{-\beta\omega}}\,,
\end{equation}
where $A(\omega)>0$ for fermions or $\sigma(\omega)=A(\omega)/\omega>0$ for bosons, and the $+$ and $-$ signs in the denominator of \eqref{eq:spectr_G_tau} are for fermions and bosons, respectively. The overall sign on the right-hand side of those expressions can also be different, the program will detect which convention you are using. It can also treat a self-energy, that has the form
\begin{equation}
\Sigma(i\omega_n)=\Sigma_{HF}+\int_{-\infty}^{\infty}\frac{d\omega}{2\pi}\,\frac{-2\text{Im}[\Sigma^R(\omega)]}{i\omega_n-\omega}\,,
\end{equation}
where $\Sigma_{HF}$ is the Hartree-Fock part.

Those expressions are spectral representations which apply very generally. They imply that $G(-i\omega_n)=G^*(i\omega_n)$ and that Re$[G(i\omega_n)]$ and Im$[G(i\omega_n)]$ behave asymptotically as $1/\omega_n^2$ and $1/(i\omega_n)$, respectively, as $\omega_n\rightarrow\infty$. 

The positivity of $A(\omega)$ or $\sigma(\omega)$ is an additional constraint necessary for the maximum entropy method to be applicable. Assuming the same sign convention as in \eqref{eq:spectr_G}, it implies that $sign(\text{Im}[G(i\omega_n)])=-sign(\omega_n)$ in the case of fermions and that Re$[G(i\omega_n)]<0$ for bosons. For data which spectral function has no definite sign, see appendix \ref{sec:non_def_sign_sf} for a description of the general procedure.

The program also accepts strictly real (even) bosonic Matsubara frequency data, i.e., even data in imaginary time representation, corresponding to a correlation function of observables having the same signature under time reversal. In that case, the code takes into account the fact that $\text{Im}[G^R(\omega)]$, where $G^R(\omega)$ is the retarded function, is odd and use the spectral representation
\begin{equation}
\begin{split}
G(i\omega_n)&=\int_{-\infty}^{\infty}\frac{d\omega}{\pi}\,\frac{\omega}{i\omega_n-\omega} \sigma(\omega)\\
&=-2\int_{0}^{\infty}\frac{d\omega}{\pi}\,\frac{\omega^2}{\omega_n^2+\omega^2}\sigma(\omega)\,,
\end{split}
\end{equation}
%\begin{equation}\label{eq:spectr_chi}
%\begin{split}
%\chi(i\omega_n)&=\int_{-\infty}^{\infty}\frac{d\omega}{\pi}\,\frac{-\text{Im}[\chi(\omega)]}{i\omega_n-\omega}\\
%&=\int_{-\infty}^{\infty}\frac{d\omega}{\pi}\,\frac{\omega \text{Im}[\chi(\omega)]}{\omega_n^2+\omega^2}\\
%&=-2\int_{0}^{\infty}\frac{d\omega}{\pi}\,\frac{\omega^2}{\omega_n^2+\omega^2}\frac{-\text{Im}[\chi(\omega)]}{\omega}\\
%&=-2\int_{0}^{\infty}\frac{d\omega}{\pi}\,\frac{\omega^2}{\omega_n^2+\omega^2}\sigma(\omega)\,,
%\end{split}
%\end{equation}
where $\sigma(\omega)=-\text{Im}[G^R(\omega)]/\omega$, instead of the default representation for bosons,
\begin{equation}\label{eq:spectr_G_bosons}
G(i\omega_n)=\int_{-\infty}^{\infty}\frac{d\omega}{2\pi}\,\frac{\omega}{i\omega_n-\omega} \sigma(\omega)\,,
\end{equation}
where $\sigma(\omega)=-2\text{Im}[G^R(\omega)]/\omega$. The output spectrum $\sigma(\omega)$ is then even and half what is obtained with \eqref{eq:spectr_G_bosons}.

\textit{$\Omega$MaxEnt} takes column-wise data files with spaces between the columns. The code was written using the Armadillo C++ linear algebra library \cite{Conrad_Sanderson:2010}, and also accept any armadillo file type.

\subsection{What the program does}\label{sec:maxent_method}

Finding the spectrum $A(\omega)$ corresponding to a given $G(i\omega_n)$ by numerically inverting expression \eqref{eq:spectr_G} or \eqref{eq:spectr_G_tau} does not work. The errors on $A(\omega)$ resulting from the ones on $G(i\omega_n)$ would be greatly amplified and the result would not make sense. This is what is called an \textit{ill-conditioned} problem. Instead, the program uses the \textit{maximum entropy} approach, which consists in minimizing
\begin{equation}\label{eq:def_Q}
Q=\chi^2-\alpha S\,,
\end{equation}
where
\begin{equation}\label{eq:chi2_KA}
\chi^2=\sum_{mn}\left(G_m-K_mA\right)^T C^{-1}_{mn}\left(G_n-K_nA\right)\,,
\end{equation}
where $A$ is the vector obtained after discretizing $\omega$, $K_n$ is a row vector such that $K_nA$ is an approximation to \eqref{eq:spectr_G}, and $C$ is the covariance matrix. $S$ is a differential entropy, defined as
\begin{equation}\label{eq:def_S}
S=-\int \frac{d\omega}{2\pi} A(\omega) \ln \frac{A(\omega)}{D(\omega)}\,,
\end{equation}
where $D(\omega)$ is called the \textit{default model}, and $\alpha$ is a parameter to be determined. The solution that minimize \eqref{eq:def_Q} if $\chi^2$ is negligible, namely that maximizes the entropy $S$, is $e^{-1}D(\omega)$, hence the name \textit{default model}. $D(\omega)$ is defined in a way to include what is known \textit{a priori} about the spectrum.

The \textit{maximum entropy} approach is based on Bayesian inference, which consists basically in using the information you know in advanced about the spectrum to deduce it from incomplete or noisy data, which alone is not sufficient to obtain acceptable results. In the present case, the entropy term $\alpha S$ is used to include that information.

To find the optimal value for $\alpha$, the program first computes the solution to min$(\chi^2-\alpha S)$ for a large range of $\alpha$. The location of the optimal $\alpha$ can then be found by a simple analysis of the shape of the function $\log\left(\chi^2\right)$ as a function of $\log(\alpha)$. The procedure is described in subsection \ref{sec:find_alpha_opt}.

Note that if we diagonalize the covariance matrix $C$, defining
\begin{equation}
\tilde{\mathbf{C}}=\mathbf{U}^\dagger\mathbf{C} \mathbf{U}\,,
\end{equation}
$\chi^2$ can be written
\begin{equation}\label{eq:chi2_short}
\chi^2=(\tilde{G}-\tilde{\mathbf{K}}A)^T(\tilde{G}-\tilde{\mathbf{K}}A)\,,
\end{equation}
where
\begin{equation}\label{eq:G_K_diag}
\begin{split}
\tilde{G}&=\sqrt{\tilde{\mathbf{C}}^{-1}}\mathbf{U}^\dagger G\,,\\
\tilde{\mathbf{K}}&=\sqrt{\tilde{\mathbf{C}}^{-1}}\mathbf{U}^\dagger \mathbf{K}\,.
\end{split}
\end{equation}
This form is more useful for practical calculations and analysis of the results.

\section{Step-by-step guide to \textit{$\Omega$MaxEnt}}\label{sec:step_by_step}

\subsection{The parameter files}

The program uses two parameter files: \textit{OmegaMaxEnt\_input\_params.dat} and \textit{OmegaMaxEnt\_other\_params.dat}. The main parameter file used to control the calculation is \textit{OmegaMaxEnt\_input\_params.dat}. The other parameter file should be modified by experienced users only, or according to instructions in this guide. The only mandatory parameter in \textit{OmegaMaxEnt\_input\_params.dat} is the data file name on the first line. Although not recommended, you can obtain results even if all the other fields are left blank. When a parameter can have the values ``yes'' or ``no'', leaving the field blank or putting anything else than ``yes'' corresponds to the default value ``no''. The parameters other than the data file name are divided in two sections. The parameters defined in the section OPTIONAL PREPROCESSING TIME PARAMETERS are used to set all the variables in the optimization problem. The parameters defined in the section OPTIONAL MINIMIZATION TIME PARAMETERS control what happens during the search for the optimal solution to the problem. They can be modified without triggering the preprocessing. Some of them can be modified during the optimization itself, as explained in subsection \ref{sec:execution}.

Before doing your first analytic continuation with \textit{$\Omega$MaxEnt}, create the two parameter files by executing the file \textit{OmegaMaxEnt}. The file \textit{OmegaMaxEnt\_input\_params.dat} will be created with all the fields blank and \textit{OmegaMaxEnt\_other\_params.dat} will be created with the default values of its parameters. When you define a parameter in \textit{OmegaMaxEnt\_input\_params.dat}, that parameter is printed on the terminal as the program reads the file. As for the parameters in \textit{OmegaMaxEnt\_other\_params.dat}, they are printed out only if you modify the default value. It is important not to modify any parameter's name, namely, any caracter up to `:' on a line. If you define a parameter or modify one's default value in one of the two parameter files and this parameter is not printed on screen when the program reads the file, it means you inadvertently modified its name in the parameter file and the program cannot find it anymore. If that happens, destroy the file and execute \textit{$\Omega$MaxEnt} to create the default version of the missing parameter file.

Unless mentioned otherwise, all the input parameters referred below are defined in the file \textit{OmegaMaxEnt\_input\_params.dat}.

\subsection{Set the input data}\label{sec:set_input_data}

Put the input file name on the line ``data file'', the first line in \textit{OmegaMaxEnt\_input\_params.dat}. If your data file is not in the same directory as the code, you can set ``input directory'' in subsection INPUT FILES PARAMETERS which tells the program where to look first for your files. If a file is not found in that directory, the program then looks for it in the current directory.

\subsubsection{$G(i\omega_n)$ as input}\label{sec:G_omega_n_in}

The data is always assumed to be given by columns in the data file, with the first column being the Matsubara frequency $\omega_n$ when the input data is $G(i\omega_n)$. By default the next two columns are assumed to be the real and imaginary parts of $G$, respectively:
\begin{equation}
\omega_n\qquad \text{Re}[G]\qquad \text{Im}[G]
\end{equation}
If $G$ is not on the $2^{nd}$ and $3^{rd}$ columns, write the correct column numbers on the lines ``Re(G) column in data file'' and ``Im(G) column in data file'' in the subsection INPUT FILES PARAMETERS. 

\subsubsection{Temperature}

If the Matsubara frequencies do not have high precision in your data file or if the first column gives only the frequency indices, set the parameter ``temperature'' in the subsection DATA PARAMETERS.

\subsubsection{$G(\tau)$ as input}

For a Green function given in imaginary time $G(\tau)$, first set the parameter ``imaginary time data'' to ``yes'' in the subsection DATA PARAMETERS. By default, the columns in the data file are assumed to be ``$\tau\qquad G$''.
%\begin{equation}
%\tau\qquad G
%\end{equation}
If $G$ is not on the $2^{nd}$ column, put the correct column number on the line ``column of G(tau) in data file'' in subsection INPUT FILES PARAMETERS. Note that the imaginary time grid must be \textit{uniform} and go from 0 to $1/T$, where $T$ is the temperature in energy units. If the temperature is specified in the subsection DATA PARAMETERS, the imaginary time grid will be redefined using the provided temperature. Otherwise, $T$ is assumed to be $1/\tau_{max}$, where $\tau_{max}$ is the last value of $\tau$ in the input file.

To get good results if your data is $G(\tau)$, the step $\Delta\tau$ must be small enough. See subsection \ref{sec:moments_Gtau} for more details.

After the preprocessing stage, the Fourier transforms of $G(\tau)$ and the covariance matrix are saved, in arma\_binary format, in directory ``Fourier\_transformed\_data'', created in your data directory. If you restart the calculation, the preprocessing will be faster if you use the Fourier transformed data instead of the original one, especially if the number of imaginary time points is large. To do so, replace ``data file'' with ``Fourier\_transform\_G.dat'', then, in section DATA PARAMETERS, erase the ``yes'' at ``imaginary time data'', in section INPUT FILES PARAMETERS, add ``Fourier\_transformed\_data'' to ``input directory'', erase your error file name at ``error file'' (or at ``imaginary time covariance file'') and set ``re-re covariance file'' to ``covar\_ReRe.dat'', ``im-im covariance file'' to ``covar\_ImIm.dat'' and ``re-im covariance file'' to ``covar\_ReIm.dat'' (see section \ref{sec:set_errors} for errors).

\subsubsection{Bosonic data}

If $G$ is bosonic, set the parameter ``bosonic data'' to ``yes'' in subsection DATA PARAMETERS.

If $G(i\omega_n)$ is also real (or $G(\tau)$ is even, i.e., symmetric with respect to $\tau=\beta/2$), set ``Im(G) column in data file'' to a value $\leq 0$. The program will then assume that $\text{Im}[G^R(\omega)]$ is odd and compute $\sigma(\omega)$ only for $\omega\geq 0$. In that case, the program also adds an additional factor of 2 to the kernel, such that the resulting spectrum is half what is obtained if the data are treated as a general bosonic function. This definition of $\sigma(\omega)$ coincide with the definition of the optical conductivity $\text{Re}[\tilde{\sigma}(\omega)]=\text{Im}[\chi_{jj}^R(\omega)]/\omega$, where $\chi_{jj}^R(\omega)$ is the retarded current-current correlation function. Internally, the program uses the other sign convention however, so that $\sigma(\omega)=-\text{Im}[G^R(\omega)]/\omega$, which implies that $\text{Re}[G(i\omega_n)]<0$. The sign of your data is not important however, as long as $\text{Re}[G(i\omega_n)]$ does not change sign (bosons only). The program will simply change the sign if it does not correspond to its internal convention.
%This is the case of a correlation function of observables having the same signature under time reversal.

\subsubsection{Self-energy}\label{sec:self_energy}

If your data is a self-energy with a frequency-independent part (the Hartree-Fock term), set parameter ``finite value at infinite frequency'' to ``yes'' in section DATA PARAMETERS. During the preprocessing, the program will try to extract the value of the constant along with the moments of the spectrum (see section \ref{sec:moments} for a discussion on moments). If ``display preprocessing figures'' is set to ``yes'' in section PREPROCESSING EXECUTION OPTIONS, you will see the figures of $G_{inf}$, $M_0$ and $M_1$ as functions of a fit frequency. If there are plateaus in those curves (even if they are very noisy), then your maximum Matsubara frequency is high enough to extract accurately the frequency-independent part and the moments (the actual values are not obtained from those curves, but from a stable least-square fit). In that case there is nothing more to do, the program will simply subtract that value from the real part of the data, so that representation \eqref{eq:spectr_G} becomes valid. If you observe plateaus in the curves of $G_{inf}$, $M_0$ and $M_1$, but one is broken at high frequency, namely that the curve ceases to be flat above a certain frequency $\omega_{inst}$, then you probably have too many Matsubara frequencies, which causes a numerical instability. In that case, discard the frequencies above $\omega_{inst}$ by setting ``truncation frequency'' to $\omega_{inst}$, or smaller, in section DATA PARAMETERS. Of course it is important not to set that parameter to a value below the flat region, otherwise it will not be possible to determine $G_{inf}$, $M_0$ and $M_1$ anymore.

If your self-energy has a frequency-independent part, but there are no plateaus at all in the figures of $G_{inf}$, $M_0$ and $M_1$, then you have to provide the constant to be subtracted at ``value at infinite frequency''. Note that the code will still attempt to extract it, but the value subtracted will be the one provided. Make sure the value you use is as accurate as possible. A small error can have a large impact and degrade the quality of the result. If you provide a value, even though the frequency cutoff is large enough to extract it, the figure of $G_{inf}$ and the value printed in the terminal as ``frequency-independant part of G'' will tell you if the value provided is correct. If so, the value computed will be much smaller than the one you provided.

If the correct frequency-independant part has been subtracted, the data can be treated the same way as a Green function. However, if you subtracted yourself that constant numerically, set ``finite value at infinite frequency'' to ``yes'' to verify that the value subtracted was accurate enough. Again, the value, computed should be much smaller than the one you subtracted.

When the input data is a self-energy, the output ``spectrum''  si $-\text{Im}[\Sigma^R(\omega)]$, where $\Sigma^R(\omega)$ is the retarded self-energy.

\subsubsection{Most basic execution}

If you do not have more information than the Green function itself, you can execute \textit{$\Omega$MaxEnt} now. See section \ref{sec:execution} for more details on the execution. If you have more information or want to learn about other functionalities, follow the next steps or see section \ref{sec:list_params}.

\subsection{Set errors}\label{sec:set_errors}

As mentioned in section \ref{sec:maxent_method}, the data's covariance matrix $C$ is used during the calculation. For a given set of data $G(i\omega_n)$, the accuracy of $C$ actually controls how well the information contained in $G$ can be transferred into the resulting spectrum $A(\omega)$. For the remaining of the guide, unless mentioned otherwise, the term ``error'' is used in a broad sense, sometimes meaning the standard deviation of data points or, more generally, referring to the covariance matrix.

The program can treat the case of a general, non-diagonal, covariance matrix, but you can simply provide the standard deviation in the case of diagonal covariance.

\subsubsection{Uncorrelated errors}

If the errors on the elements of $G$ are uncorrelated, define the parameter ``error file'' in the subsection INPUT FILES PARAMETERS and the correct column numbers on the lines ``Re(G) column in error file'' and ``Im(G) column in error file'' if the input is $G(i\omega_n)$, or on the line ``column of $G(\tau)$ error in error file'' if the input is $G(\tau)$, unless the column number(s) correspond to the default value(s).

\subsubsection{Correlated errors}\label{sec:corr_errors}

If the errors are correlated between elements of $G$ and you have the covariance matrix
\begin{equation}
C_{ij}^{\mu\nu}=\frac{1}{N-1}\sum_{l=1}^N \left(G_{il}^\mu-\bar{G}_i^\mu\right)\left(G_{jl}^\nu-\bar{G}_j^\nu\right)
\end{equation}
where $N$ is the number of sample values for each element $G_i^\mu$, indices $\mu,\nu$ refer to real (Re) of imaginary (Im) parts , $G_{il}^\mu$ is the $l^{th}$ sample of $G_i^{\mu}$, and 
\begin{equation}
\bar {G}_i^\mu=\frac{1}{N}\sum_{l=1}^N G_{il}^\mu\,,
\end{equation}
then, in subsection INPUT FILES PARAMETERS, provide that matrix using the parameters ``re-re covariance file'', ``im-im covariance file'' and ``re-im covariance file'', if the input is $G(i\omega_n)$, or ``imaginary time covariance file'', if the input is $G(\tau)$. Those files must contain an equal number of lines and columns.
%\begin{itemize}
%\item ``re-re covariance file'', ``im-im covariance file'' and ``re-im covariance file'', if $G$ is given in Matsubara frequency, 
%\item ``imaginary time covariance file'', if $G$ is given in imaginary time. 
%\end{itemize}

\subsubsection{Unknown error}

If you do not have an estimate of the covariance matrix for your data, which is usually the case for non-stochastic data, for example, the best way to use the program is to add noise of different magnitude to the data and observe, as the magnitude decreases, if the spectrum converges. Using the line ``added noise relative error'' in section INPUT FILES PARAMETERS, you can do so in an automatized way by providing a vector of relative standard deviations of the form ``s1 s2 ...'', for example, ``1e-3 1e-4 1e-5''. The program then starts by adding normally distributed noise of constant relative standard deviation ``s1'' to the data, before performing the analytic continuation. Then, if the program is in interactive mode (default mode), and you entered more than one value of added noise error, it will ask you if you want to proceed with the next value once you stop the current calculation. If the program is not in interactive mode, it proceeds automatically to the next value of relative error provided. The results for each value in the vector is stored in folders with names ending with that value.

The line ``added noise relative error'' is ignored if you provide an error file or covariance files.

Additional smoothing of the added error can be performed using parameters ``Nsmooth\_errG'' and ``wgt\_min\_sm'' in file \textit{OmegaMaxEnt\_other\_params.dat}. This can be useful to define a smooth error for very noisy data, for example. Note that, if Nsmooth\_errG=0 (default value), a minimal smoothing is performed nonetheless, with Nsmooth\_errG=1, on the error of the real part of fermionic data and on the imaginary part of bosonic data to ensure that the errors are not too small at frequencies where the data vanishes or nearly vanishes.

If you provide imaginary time data and you do not have any estimate of the error on your imaginary time data, it is better not to provide any error file. If you do, the program will have to Fourier transform the error to obtain a Matsubara frequency covariance matrix, which can considerably increase the preprocessing time. Instead, you can let the program assume a constant diagonal covariance by default, or use the ``added noise relative error'' parameter to add diagonal noise to the Fourier transformed data.

\subsubsection{Basic execution}

If you do not have more information, you can execute \textit{$\Omega$MaxEnt} now. See section \ref{sec:execution} for more details on the execution. If you have more information or want to learn about other functionalities, follow the next steps or see section \ref{sec:list_params}.

\subsection{Control how moments are used}\label{sec:moments}

The part of the Green function at frequencies $\omega_n > W$, where $A(|\omega|>W)=0$, can be expressed as a high frequency expansion, of which the coefficients are the moments of the spectral function $A(\omega)$. However, because of finite precision and noise, the information on high order moments is not present in the data. Therefore, the high frequencies of $G(i\omega_n)$ contain the information about a few moments only. It is thus numerically equivalent, but computationally more efficient to replace the large number of constraints corresponding to those high frequencies in the calculation by the few contraints corresponding to those moments.

The moments are also used during the definition of the real frequency grid and the default model, since they tell us about global properties of the spectrum, among which the center and the width of the spectrum.

\subsubsection{Use \textit{$\Omega$MaxEnt} to extract moments}\label{sec:moments_extraction}

If the Matsubara frequency cutoff $\omega_{n_{max}}$ of your data is in the asymptotic part of $G(i\omega_n)$, namely that the condition $\omega_{n_{max}}>W$ is satisfied, the program can extract moments from your data by fitting a high frequency expansion to the asymptotic part, and determine the onset of the asymptotic regime at the same time. Unless you provide enough moments or real frequency grid parameters, \textit{$\Omega$MaxEnt} will try to extract them and use them in the calculation instead of the high frequencies they are extracted from. When it performs that procedure, if you set the parameter  ``display preprocessing figures'' to ``yes'' in subsection PREPROCESSING EXECUTION OPTIONS, you can check for convergence in the computation of the moments from the figures of the norm $M_0$ and the first moment $M_1$ plotted as a function of the fit frequency. If there are plateaus in those curves above a certain frequency, then the values are converged. If you observe plateaus in the curves but at least one of the plateaus is broken at high frequency, namely that the curve ceases to be flat above a certain frequency $\omega_{inst}$, then you probably have too many Matsubara frequencies, which causes a numerical instability. In that case, discard the frequencies above $\omega_{inst}$ by setting ``truncation frequency'' to $\omega_{inst}$, or smaller, in section DATA PARAMETERS. Of course it is important not to set that parameter to a value below the flat region, otherwise it will not be possible for the program to extract the moments.

In any case, you can force the program to extract the moments by setting ``evaluate moments'' to ``yes'' in subsection COMPUTATION OPTIONS. You can also control how many moments are used during the computation of the spectrum with the parameter ``maximum moment''  in the same subsection. By default, \textit{$\Omega$MaxEnt} imposes the first 4 moments (including the norm $M_0$) to the spectrum for fermions, and the first 3 moments for bosons. For example, if you want the program to impose only the norm and the first moment, set ``maximum moment'' to 1.

You can also control the maximum frequency to be used in the calculation with the parameter ``Matsubara frequency cutoff'' in subsection FREQUENCY GRID PARAMETERS. For example, if you do not have enough frequencies in the asymptotic frequency range, or your data are very noisy at high frequency, it is probably better to use all the frequencies instead of the moments by setting ``maximum moment'' to 0 (if the norm is known exactly) and ``Matsubara frequency cutoff'' to a value larger than the last frequency in your data.

\subsubsection{Norm of the spectrum}\label{sec:norm}

If your spectrum is normalized to 1, namely, if the leading high frequency term of the data is $1/(i\omega_n)$, you do not have to provide the norm. Also, if you have real bosonic Matsubara data and have set ``Im(G) column in data file'' to 0 or less, the norm is automatically assumed to be 0.

If the norm is not 1, you can use ``norm of spectral function'' in subsection DATA PARAMETERS to provide it, or let the program extract it from the data by setting ``evaluate moments'' to ``yes'' in subsection COMPUTATION OPTIONS. It is also better to set ``display preprocessing figures'' to ``yes'' to verify convergence on the figure of $M_0$, namely that a plateau appears in the curve.

%Once ``norm of spectral function'' is set, you can disable ``preprocess only'' and continue the execution.
%and ``preprocess only'' to ``yes'' in PREPROCESSING EXECUTION OPTIONS to prevent the actual calculation from starting after the preprocessing.

%If you do not know the norm and there is not enough frequencies in your data to allow the program to extract it, namely there is no plateau in the figure of $M_0$, just tell the program not to use moments at all by setting ``maximum moment'' to $-1$ or less.

\subsubsection{Providing moments}\label{sec:provide_moments}

If you know some moments of the spectral function with good precision, you can provide them with their respective errors in subsection DATA PARAMETERS.

If you provide enough moments (first and second for fermions, first for bosons), the program will not try to extract them from your data. In that case however, it is recommended to set ``evaluate moments'' and ``display preprocessing figures'' to ``yes'' in subsection COMPUTATION OPTIONS when running \textit{$\Omega$MaxEnt} for the first time with a given set of data. This way, provided that your data has some frequencies in the asymptotic part of $G$ (if so, there will be a plateau in the figures of $M_0$ and $M_1$), you can verify if the moments you provided have values close to the ones extracted, which will be printed in the terminal. In addition, the program will also print where the asymptotic regime sets in. This verification step is important to make sure you do not impose wrong moments to the spectrum, which is worse than not imposing any. When making that verification, set ``preprocess only'' to ``yes'' to prevent the actual calculation from starting.

Once you provided moments, if your Matsubara frequency cutoff is far in the asymptotic part of $G$ (there are long plateaus in the figures of $M_0$ and $M_1$ when ``evaluate moments''), set ``Matsubara frequency cutoff'' in subsection FREQUENCY GRID PARAMETERS to the onset value given by the program. Note that this is done automatically if ``evaluate moments'' is enabled. If the asymptotic regime is not reached at the cutoff, you can make sure that all the frequencies are used, whatever the value of ``evaluate moments'' is, by setting ``Matsubara frequency cutoff'' to a value larger than the cutoff.

\subsubsection{$G(\tau)$ as input data}\label{sec:moments_Gtau}

If you have imaginary time data, the first two finite moments $M_1$ and $M_2$ are necessary to Fourier transform $G(\tau)$ before computing the spectrum from the resulting $G(i\omega_n)$ (with which \textit{$\Omega$MaxEnt} works internally). Thus in that case either you provide those moments, or the program extracts them from $G(\tau)$. In the latter case, it does so using a polynomial fit to $G(\tau)$ around the boundaries $\tau=0$ and $\beta$. The condition for that fit to give the correct moments is that $\Delta\tau<1/W$ (see introduction of section \ref{sec:moments} for the definition of $W$), where $\Delta\tau$ is the imaginary time step. This condition is equivalent to $\omega_{n_{max}}>W$. Ideally, $\Delta\tau$ should be at least a few times smaller than $1/W$. Thus, if you provide $G(\tau)$ as the input data and do not know $M_1$ and $M_2$, make sure the imaginary time step is small enough so that this condition is satisfied. If you do know $M_1$ and $M_2$ with good accuracy, note however that, even though the Fourier transform of $G(\tau)$ will be accurate, the Fourier transform of the error will not be if $\Delta\tau$ is not small enough, which may degrade the quality of the result. It is thus preferable that the condition $\Delta\tau<1/W$ be well satisfied in any case.

\subsubsection{Basic execution}

You can execute \textit{$\Omega$MaxEnt} here. See section \ref{sec:execution} for more details on the execution. Otherwise, follow the next steps or see section \ref{sec:list_params} to learn about other functionalities.

\subsection{Modify the frequency grid}\label{sec:user-defined_grid}

The real frequency grid used by \textit{$\Omega$MaxEnt} is separated in two different types of grid: a central dense part, let us call it the \textit{main spectral range}, where most of the spectral weight should be found, and two non-uniform high frequency parts, where the step size increases approximately quadratically with the module of the frequency. Let us address how to control the grid in the main spectral range first.

By default, the main spectral range is defined as a region of width $SW=\textit{f\_SW\_std\_omega}*\Delta\omega_{std}$ and centered on $SC=M_1$, where $\Delta\omega_{std}=\sqrt{M_2-M_1^2}$ (fermionic case) is the standard deviation of the spectrum (the $M_i$s are the moments of the spectrum) and \textit{f\_SW\_std\_omega} is a parameter defined in file \textit{OmegaMaxEnt\_other\_params.dat}. The grid in that region is uniform with a number of frequencies defined in two possible ways: if there is a sharp and well isolated peak at low frequency, the program can estimate its width directly from the Matsubara data (see appendix \ref{sec:peak_width}) and use a step appropriate to resolve that peak, otherwise, the step is defined as $\Delta\omega_{std}/\textit{Rmin\_SW\_dw}$ (if $\Delta\omega_{std}$ is known) or $SW/(\textit{f\_SW\_std\_omega}*\textit{Rmin\_SW\_dw})$, where \textit{Rmin\_SW\_dw} is defined in \textit{OmegaMaxEnt\_other\_params.dat}. 

The default grid is of course not optimal in many cases, especially for spectra possessing very broad and very sharp features at the same time. For those cases, \textit{$\Omega$MaxEnt} offers a few ways to define a better adapted grid with the parameters of subsection FREQUENCY GRID PARAMETERS:
\begin{enumerate}
\item If parameter ``use non uniform grid in main spectral range'' is set to ``yes'', there are two possibilities: 1) If parameter ``real frequency step'' is not defined and no peak has been detected at $\omega=0$, 
%or the peak width $w_{pk}$ is above $\textit{R\_peak\_width\_dw}*\Delta\omega_{std}/\textit{Rmin\_SW\_dw}$, where \textit{R\_peak\_width\_dw} and \textit{Rmin\_SW\_dw} are defined in \textit{OmegaMaxEnt\_other\_params.dat}, 
the default grid just described is used. 2) If either parameter ``real frequency step'' is defined or a narrow peak has been detected at $\omega=0$, the program will define a non-uniform grid for the main spectral region. This grid is defined by first generating, in an automatized way, a vector of the form 
\begin{equation}\label{eq:vec_interv}
\begin{bmatrix}
\omega_0& \Delta\omega_0& \omega_1& \Delta\omega_1& \ldots \omega_{N-1}& \Delta\omega_{N-1}& \omega_N
\end{bmatrix}\,,
\end{equation}
where the $\omega_i$'s are frequencies delimiting intervals and the $\Delta\omega_i$'s are the steps in those intervals. The steps in the intervals are chosen to increase by a factor of two, starting from the smallest value given by parameter ``real frequency step'', if defined, or $w_{pk}/\textit{R\_peak\_width\_dw}$ otherwise, around parameter ``real frequency grid origin'', if defined, or $\omega=0$ otherwise. The ratio of an interval's length and its step is fixed by parameter \textit{R\_Dw\_dw} in file \textit{OmegaMaxEnt\_other\_params.dat}. The width of the main spectral region for this type of grid is at least equal to parameter ``spectral function width'', if defined, or otherwise at least equal to $2\omega_{as}/\textit{R\_wncutoff\_wr}$, where $\omega_{as}$ is the onset Matsubara frequency of the asymptotic part of the data, or $\textit{R\_SW\_wr}*SW$, whichever is the largest value (\textit{R\_wncutoff\_wr} and \textit{R\_SW\_wr} are defined in \textit{OmegaMaxEnt\_other\_params.dat}). Parameter ``spectral function center'', if defined, or the first moment $M_1$ otherwise, is also used to center the main spectral range. Finally, from the vector \eqref{eq:vec_interv} the program then generates a grid with a step varying smoothly between intervals, with a hyperbolic tangent shape, using parameter \textit{RW\_grid}, defined in \textit{OmegaMaxEnt\_other\_params.dat}, as the ratio of an interval's size and the size of the transition region between its step and the steps in adjacent intervals. This grid is then used only in the main spectral range.\label{sec:nu_grid}
\item You can define yourself a uniform grid for the main spectral range by setting one or more of the parameters ``spectral function width'', ``spectral function center'' and ``real frequency step''. The first two of those parameters are used as $SW$ and $SC$ (instead of the default ones defined from the moments), which define the main spectral range $[SC-SW/2, SC+SW/2]$, where the step will be set to ``real frequency step''. The default values given above are used for those of these parameters that are left blank. You can also make sure that a specific frequency is included in the grid with the parameter ``real frequency grid origin''. This is useful, for example if the position of a peak is known precisely, to make sure that there is a grid point at the maximum. If ``real frequency grid origin'' is not defined, but ``spectral function center'' is, the two values will coincide. 
\item You can define yourself a non-uniform grid in the main spectral range by setting the parameter ``use parameterized real frequency grid'' to ``yes'' and by providing a vector of the form \eqref{eq:vec_interv}, defining intervals and their respective steps, on the line ``grid parameters''. The $\omega_i$'s are the frequencies delimiting the intervals and the $\Delta\omega_i$'s are the steps in those intervals. The program then generates a grid with a step varying smoothly (with a hyperbolic tangent shape) between intervals. This grid is then used only in the main spectral range. Note that it is important not to change the step too quickly between consecutive intervals. There should not be more than a factor of three between steps in consecutive intervals, otherwise spurious structures may appear in the spectrum at the boundaries between intervals. Each interval should also contain a few tens of points at least (30 is good for a factor of 2 between consecutive steps) to avoid spurious structures. Finally, you can also use parameter, \textit{RW\_grid}, defined in \textit{OmegaMaxEnt\_other\_params.dat}, to control the ratio of an interval's size to the size of the transition region between its step and the steps in adjacent intervals. A smaller ratio will produce a smoother grid density. You should keep \textit{RW\_grid}$\geq 2$.
\item Finally, you can provide your own grid with the parameter ``real frequency grid file''. The grid must be on the first column of the file. Note however that, unless it is a grid that was previously generated by \textit{$\Omega$MaxEnt}, it will be used only in the main spectral range, which is defined either by the default values of $SW$ and $SC$ or by ``spectral function width'' and ``spectral function center''. On the other hand, if the file you provide is a spectrum obtained by the program in a previous calculation, the whole grid, including the high frequency parts, will be identical to the provided one.
\end{enumerate}

The grid in the regions outside the main spectral range is always defined in the same way by the program. Instead of having a uniform step $\Delta\omega$, the grid in those regions is such that $\Delta u=u_{i+1}-u_i$ is constant, where $u_i=1/(\omega_i-\omega_{0l})$ on the left side and $u_i=1/(\omega_i-\omega_{0r})$ on the right side. Here, $\omega_{0l}$ and $\omega_{0r}$ are frequencies determined by the extrema of the grid, which can be controlled by the parameter \textit{f\_w\_range} defined in file \textit{OmegaMaxEnt\_other\_params.dat}. More precisely, \textit{f\_w\_range} is the ratio of the total size of the grid $\omega_{max}-\omega_{min}$ to the width of the main spectral range $SW$. Note however that the default value for parameter \textit{f\_w\_range} is optimal and should not require any modification.

\subsection{Modify the default model}

By default, the default model is a gaussian of width equal to the standard deviation $\Delta\omega_{std}=\sqrt{M_2-M_1^2}$ (fermionic case), if $M_1$ and $M_2$ are defined (provided by you or extracted from the data), or equal to parameter ``spectral function width'' (subsection FREQUENCY GRID PARAMETERS), and centered on $M_1$ (fermionic case), or ``spectral function center'' (subsection FREQUENCY GRID PARAMETERS) if $M_1$ is not defined.

If you want to use a different default model, there are two options:
\begin{enumerate}
\item You can use the parameters ``default model center'' ($DC$), ``default model half width'' ($DW$) and ``default model shape parameter'' ($DS$) in subsection COMPUTATION OPTIONS to use a default model that has a \textit{generalized normal distribution} form. As special cases, if $DS=1$, this corresponds to a Laplace distribution, if $DS=2$, it is a gaussian, and as $DS\rightarrow\infty$, the distribution becomes uniform in the range $[DC-DW,DC+DW]$. It is recommended to set ``default model shape parameter'' to a value larger than 1, since for $DS\leq 1$, there is a discontinuity in the derivative at $DC$, which is not physical in general, except in the presence of a Van Hove singularity.
\item You can also use your own default model by setting the parameter ``default model file'' (subsection COMPUTATION OPTIONS). It is assumed that the first column is the grid and the second column is the function value. The grid on which your function is defined can be arbitrary, the program uses cubic splines to interpolate your function on the active grid, namely the one set previously during preprocessing. If your grid does not extend over the whole active grid, the program will extend your function with gaussians matching it as smoothly as possible at the extrema of your grid.
\end{enumerate}

The default model is always normalized to the same value as the spectrum, namely $M_0$ in the fermionic case, or $G(i\omega_n=0)$ in the bosonic case.

\subsection{Execution}\label{sec:execution}

By default, \textit{$\Omega$MaxEnt} runs in an interactive loop. You can however disable the interactive mode by setting ``interactive mode'' to ``no'' in subsection MINIMIZATION EXECUTION OPTIONS. In interactive mode, there are a few ways, given below, to pause the execution to see the result at a given stage and with a given set of input parameters. At the pause, the program always asks if you want to continue execution. To do so, simply press ENTER, or enter anything else than 'y' to stop. During a pause, you can make changes to the parameter files. Depending on the type of changes you made, execution can resume either from the point it halted, or at an earlier stage. If you modify a parameter in section OPTIONAL PREPROCESSING TIME PARAMETERS during a pause, the preprocessing starts over. On the other hand, the parameters in section OPTIONAL MINIMIZATION TIME PARAMETERS, with the exception of ``initialize preprocessing'', can be modified during a pause without triggering the preprocessing when execution continues. Some parameters in that subsection will however cause the minimization stage to restart at the initial (highest) $\alpha$ if they are modified, namely ``output directory'', ``spectral function sample frequencies'', ``initial value of alpha'' and ``initialize maxent''.

To pause execution, you can use one of the following parameters:
\begin{itemize}
\item ``preprocess only'' (subsection PREPROCESSING EXECUTION OPTIONS),
\item ``minimum value of alpha'' ($\alpha_{min}$) (subsection COMPUTATION PARAMETERS),
\item ``number of values of alpha computed in one execution'' ($N_{\alpha_{max}}$) (subsection MINIMIZATION EXECUTION OPTIONS).
\end{itemize}

The parameter ``preprocess only'' can be used to do some verifications with input parameters, and try different values, before starting the actual calculation. For example, you can verify the values of moments with the ones extracted from the data, or check that your grid has a reasonable number of frequencies. If ``display preprocessing figures'' is enabled (subsection PREPROCESSING EXECUTION OPTIONS), the preprocessing stops when a group of figures is displayed, and you have to close them to resume it. This pause is not the right time to modify the parameter files however, since they will not be read when execution resumes once the figures are closed. Once you are satisfied with the input parameters, you can disable ``preprocess only'' to start computing the spectrum. 

The parameters ``minimum value of alpha'' and ``number of values of alpha computed in one execution'' can be used to look at the results at intermediate stages during minimization time, where the spectrum is computed as a function of $\alpha$. By default, at each pause during that part of the calculation, the program displays figures showing the results at the optimal $\alpha$, if it has been found, and at the last (lowest) value of $\alpha$ computed. A list of the output figures is given in section \ref{sec:out_figs}. Once you have closed all the figures, the program asks you if you want to continue execution. You can also choose which groups of figures are displayed with parameters ``show optimal alpha figures'', ``show lowest alpha figures'' and ``show alpha dependant curves'' in subsection DISPLAY OPTIONS. 

If you have set ``minimum value of alpha'' and $\alpha_{min}$ is reached before the condition for the calculation to be over is satisfied (see section \ref{sec:calc_over}), the program will tell you that $\alpha_{min}$ is not small enough and will reduce it by the factor \textit{f\_alpha\_min}, defined in file \textit{OmegaMaxEnt\_other\_params.dat}, before asking if you want to continue execution. If you have set ``number of values of alpha computed in one execution'', the spectrum will be computed for $N_{\alpha_{max}}$ values of $\alpha$ each time the calculation is resumed, unless that parameter is emptied during a pause.

%The program looks for $\alpha_{opt}$ when $\chi^2$ is smaller than a certain value $\chi^2_{opt\_max}=\textit{f\_chi2save}*N_{\chi^2}$, where \textit{f\_chi2save} is defined in \textit{OmegaMaxEnt\_other\_params.dat}, and $N_{\chi^2}=2N_{\omega_n}+N_M$ is the number of terms in $\chi^2$ ($N_{\chi^2}=N_{\omega_n}+N_M$ for \textit{real} bosonic data$, N_M=$ number of moments imposed).  However, $\chi^2_{opt\_max}$ is estimated by assuming that the provided errors (or the default ones if none are provided) are close to the actual ones. If this assumption is not satisfied, it may happen that $\chi^2_{opt\_max}$ is smaller than the value of $\chi^2$ at $\alpha_{opt}$. In that case, when the program finds $\alpha_{opt}$, it will warn you that the spectrum was not saved at that value of $\alpha$. You can then use ``alpha value below which all spectral functions are saved'' (subsection OUTPUT FILES PARAMETERS) or ``maximum optimal alpha'' (subsection COMPUTATION PARAMETERS) to increase the maximum value of $\alpha_{opt}$. You can also modify \textit{f\_chi2save} in file \textit{OmegaMaxEnt\_other\_params.dat} to increase $\chi^2_{opt\_max}$. You will also have to set ``initialize maxent'' to ``yes'' (subsection MINIMIZATION EXECUTION OPTIONS) to restart the minimization stage at the initial $\alpha$.

%Finally, another condition will stop the minimization stage, this is if $\chi^2/N_{\chi^2}<$\textit{f\_chi2min}, where \textit{f\_chi2min} is defined in \textit{OmegaMaxEnt\_other\_params.dat}. The program would then tell you that the minimum ratio of $\chi^2$ and the number of terms in it is reached. If so, and the optimal spectrum has not been found yet, reduce \textit{f\_chi2min} by a few orders of magnitude.

\subsection{Output figures}\label{sec:out_figs}

The following functions are plotted when the execution stops during the minimization stage:
\begin{itemize}
\item $\log_{10}\left(\chi^2\right)$ versus $\log_{10}\left(\alpha\right)$\,,
\item Relative entropy $S$ versus $\log_{10}\left(\alpha\right)$\,,
\item Curvature of $\log\left(\chi^2\right)$ vs $\gamma\log\left(\alpha\right)$\,,
\item Spectral function at the \textit{lowest} $\alpha$ ($\alpha_{low}$): $A$ vs $\omega$\,,
\item Spectral function at the \textit{optimal} $\alpha$ ($\alpha_{opt}$): $A_{opt}$ vs $\omega$ (if $\alpha_{low}<\alpha_{opt}$)\,,
\item Spectral function at sample frequencies: $A(\omega_{samp})$ versus $\alpha$\,,
\item Normalized deviation $\Delta \tilde{G}=\tilde{G}_{in}-\tilde{G}_{out}$ versus frequency index $n$ (diagonal covariance) or covariance eigenvector index $i_c$ (general covariance), at the \textit{lowest} $\alpha$ (two figures: real and imaginary parts),
\item Normalized deviation $\Delta \tilde{G}_{opt}$ versus frequency index $n$ (diagonal covariance) or covariance eigenvector index $i_c$ (general covariance), at the \textit{optimal} $\alpha$ (if $\alpha_{low}<\alpha_{opt}$) (two figures: real and imaginary parts),
\item Autocorrelation of $\Delta \tilde{G}$ vs $\Delta n$ (diagonal covariance) or $\Delta i_c$ (general covariance) at the \textit{lowest} $\alpha$ (two figures: real and imaginary parts),
\item Autocorrelation of $\Delta \tilde{G}_{opt}$ vs $\Delta n$ (diagonal covariance) or $\Delta i_c$ (general covariance) at the \textit{optimal} $\alpha$ (if $\alpha_{low}<\alpha_{opt}$) (two figures: real and imaginary parts).
\end{itemize}

In the figure showing the spectrum at $\alpha_{opt}$, a spectrum at a value of $\alpha$ slightly below $\alpha_{opt}$ and one at a value slightly above are also plotted. Those two other values of $\alpha$, say $\alpha_{opt-}$ and $\alpha_{opt+}$, delimit the range of the crossover region between the \textit{information-} and the \textit{noise-fitting} regimes. Along with the optimal spectrum, the spectra at $\alpha_{opt-}$ and $\alpha_{opt+}$ tell how stable the spectrum is around $\alpha_{opt}$, and thus how accurate the results are (see also section \ref{sec:Asamp}).


\subsection{How the optimal $\alpha$ is chosen}\label{sec:find_alpha_opt}

If you look at $\log\left(\chi^2\right)$ as a function of $\log\left(\alpha\right)$ for a large enough range of $\alpha$, you will notice that there are three regimes in that function. At high $\alpha$, the entropy term $\alpha S$ dominates in the quantity $Q=\chi^2-\alpha S$ that is minimized with respect to the spectrum $A$ (see section \ref{sec:maxent_method}). Thus, $\chi^2$ decreases very slowly with $\alpha$ and the spectrum stays close to default model. We may call this the \textit{default model regime}. At intermediate values of $\alpha$, $\chi^2$ decreases rapidly as $\alpha$ decreases. This is the regime where the information in input data $G_{in}$ is gradually integrated in the spectrum $A(\omega)$ (or $G_{out}=\mathbf{K}A$) as $\alpha$ decreases. It is thus an \textit{information-fitting regime}. Finally, when most of the information in $G_{in}$ is already present in $A(\omega)$, the noise in $G_{in}$ starts to be integrated into $A(\omega)$, as $\Delta G=G_{in}-G_{out}$ becomes smaller than the error on $G_{out}$. At that point, the rate of change of $\chi^2$ with $\alpha$ decreases rapidly, and becomes very small, in what we may call the \textit{noise-fitting regime}. The optimal alpha should clearly be chosen where most of the information in $G_{in}$ is contained in $A(\omega)$ (or $G_{out}$), but not its noise. It should therefore be somewhere in the crossover region between the \textit{information-} and the \textit{noise-fitting regime}. 

The change of decreasing rate of $\chi^2$ with $\alpha$ can be identified by a peak in the curvature of $\log\left(\chi^2\right)$ vs $\log\left(\alpha\right)$. The optimal $\alpha$, say $\alpha_{opt}$, can simply be chosen at the highest peak maximum. However, in some cases, peaks other than the one marking the onset of the \textit{noise-fitting regime} may be present in the curvature at values of $\alpha$ larger than $\alpha_{opt}$. To avoid choosing those peaks by accident instead of the correct one, one can choose the optimal $\alpha$ at the highest peak maximum in the curvature of $\log\left(\chi^2\right)$ vs $\gamma\log\left(\alpha\right)$, where $\gamma$ is typically between 0.1 and 0.5, instead. The factor $\gamma$ increases the ratio of the amplitudes of the correct peak and the other peaks located at higher $\alpha$, which reduces the probability of choosing the wrong peak. It displaces the position of the crossover peak maximum toward the \textit{noise-fitting} region however, but only very slightly if $\gamma$ is not too small, so that it barely affects the result.

As will be mentioned in section \ref{sec:out_files}, the spectra are saved for a certain range of $\alpha$ around the optimal one. Therefore, you can also choose yourself the value of $\alpha$ that you find the most reasonable from the output figures and use the spectrum saved in the corresponding file instead of the one saved in ``optimal\_spectral\_function\_tem\#\_alpha\#.dat'' (see section \ref{sec:out_files}).

If, for some reason, the value of $\alpha$ chosen by the program is not the one you think is optimal, for example if there are more than one peak in the curvature $\log\left(\chi^2\right)$ vs $\log\left(\alpha\right)$ in the region where the optimal alpha should be located, you can also choose the region where the program will search for the optimal $\alpha$ with the parameters ``maximum optimal alpha'' and ``minimum optimal alpha'' in subsection COMPUTATION PARAMETERS.

When the error (standard deviation or covariance) is known precisely, the crossover region is narrow, and it is clear what is the optimal value. This is because, in that ideal case, the ratio of $\Delta G$ and the error tends to stay comparable at different $\omega_n$ (or covariance eigenvector index $i_c$) as $\alpha$ decreases, and thus the noise in $G_{in}$ starts to be fitted around the same value of $\alpha$ at \textit{all} frequencies $\omega_n$ ($i_c$). On the other hand, if the error is not well estimated, the crossover region, where both noise and information are fitted at the same time, becomes wider. The choice of optimal $\alpha$ is then more arbitrary. In that case, the best solution is of course to improve the error, if that is possible. If not, you can also use the other output figures to help you choose the $\alpha$ that corresponds to the best compromise according to your judgement. In particular, in addition to the spectrum itself, the figures described in subsections \ref{sec:DG} and \ref{sec:Asamp} can help you diagnose more precisely the problems with the errors, in order to improve it, or help you find the best compromise in the choice of the optimal $\alpha$.

\subsection{Properties of $\Delta \tilde{G}=\tilde{G}_{in}-\tilde{G}_{out}$ at the optimal $\alpha$}\label{sec:DG}

The analytic continuation operation consists essentially in fitting the function $\tilde{G}_{out}=\tilde{\mathbf{K}}A$ to the input data $\tilde{G}_{in}$, where $\tilde{G}$ is a Green function vector expressed in the eigenbasis of the covariance matrix, and normalized by the standard deviation in that basis. The function $\Delta \tilde{G}=\tilde{G}_{in}-\tilde{G}_{out}$ as a function of $\omega_n$ (or covariance eigenvector index $i_c$) is very useful to assess the quality of the fit. To have a good fit, that function must satisfy the two following conditions:

1) $\Delta\tilde{G}$  is essentially noise at the optimal $\alpha$:

When most of the information contained in $G_{in}$ is also in $G_{out}$, but not the noise, $\Delta\tilde{G}$ is essentially the noise in $G_{in}$ at the optimal $\alpha$. In addition, because $\Delta\tilde{G}$ is normalized, it has a standard deviation of 1. This is what we obtain when the covariance matrix of the data is accurate. If the error is simply multiplied by an global factor $f_{err}$, $\alpha_{opt}$ will simply be reduced by $f_{err}^2$ and the standard deviation of $\Delta\tilde{G}$ reduced by $f_{err}$, but no effect will be seen on the spectrum at the (new) optimal $\alpha$. However, if the ratio of the errors in different frequency ranges is not well estimated, $G_{out}$ will eventually contain some of the noise of $G_{in}$ in a given frequency range, namely $\Delta\tilde{G}$ will be smaller than the error in that range, while not yet containing all the information in another range. $\Delta\tilde{G}$ will then have both noisy regions and structured ones. If that problem is too serious, distorsions appear in some parts of the spectrum $A(\omega)$, although some of the information in $G_{in}$ does not yet appear in it. That problem can be reduced by rescaling the errors in one frequency range with respect to the other. This can be done by multiplying the errors by a smooth function of frequency. 

2) There is no correlations between neighboring frequencies (or $i_c$) of $\Delta\tilde{G}$:

Look at the autocorrelation of $\Delta\tilde{G}$ as a function of Matsubara index differences $\Delta n$ (or $\Delta i_c$) to see if the noise in $\Delta\tilde{G}$ is correlated or not between neighboring frequencies. At the optimal $\alpha$, the autocorrelation should look like a noisy Kronecker delta function. The value at the origin is equal to $\chi^2/N_{\chi^2}$, where $N_{\chi^2}$ is the number of terms in $\chi^2$, which should be close to 1 at $\alpha_{opt}$ if the magnitude of the error is correct. In most cases, the actual error is not very precise, therefore, only the structure of the autocorrelation really matters. 

If you have assumed that the covariance is diagonal, and observe, even though $\Delta \tilde{G}$ seems to contain only noise, that the autocorrelation does not have a noisy Kronecker delta shape for $\alpha\leq\alpha_{opt}$, you should use a non-diagonal covariance matrix instead of a diagonal one.

\subsection{Spectrum at sample frequencies vs $\alpha$}\label{sec:Asamp}

When the execution stops during minimization, the program also plots the spectrum at a number of sample frequencies as a function of $\log\alpha$. By default, the program uses \textit{Nwsamp} uniformly distributed frequencies in the main spectral region, where \textit{Nwsamp} is defined in file \textit{OmegaMaxEnt\_other\_params.dat}. To choose the sample frequencies yourself, use parameter ``spectral function sample frequencies'' in subsection OUTPUT FILES PARAMETERS in file \textit{OmegaMaxEnt\_input\_params.dat}.

In an ideal case, where the error (standard deviation or covariance) is known precisely, the curves corresponding to different frequencies have stable, or ``quasi-stable'', point at the \textit{same} $\alpha$, which happens to be located in the crossover between the \textit{information-} and the \textit{noise-fitting} regions, where the optimal $\alpha$ ($\alpha_{opt}$) is chosen using the $\log\left(\chi^2\right)$ vs $\log(\alpha)$ curve (see subsection \ref{sec:find_alpha_opt}). If the error is small enough, the curves are actually stable around $\alpha_{opt}$, and eventually have plateaus that overlap around $\alpha_{opt}$ as the error gets even smaller, which indicates quantitatively accurate results. Otherwise, the curves are ``quasi-stable'' at $\alpha_{opt}$, namely they have either extrema, or inflexion points with a non-vanishing derivative. Below $\alpha_{opt}$, in the \textit{noise-fitting} region, the results eventually become unstable and the curves can increase or decrease very quickly. 

On the other hand, if the error is not well known, there is necessarily some imbalance between different Matsubara frequency ranges. The result of that imbalance will be that the (quasi-)stable points in different real frequency regions of the spectrum will not be aligned. Those regions will have different ``optimal'' values of $\alpha$, and thus there will be no well defined single optimal $\alpha$. In that case, if possible, it is preferable to modify the error to improve balance between frequency ranges. Otherwise, if the value determined automatically by the program does not appear to be the best, the spectrum sample frequencies curves, combined with the figures of $\Delta\tilde{G}$ and its autocorrelation, can help you choose a better compromise.

To summarize, the \textit{spectrum sample frequencies vs $\alpha$} curves tell you 
\begin{enumerate}
\item what the optimal $\alpha$ is in a given real frequency range,
\item if the errors are well balanced between different Matsubara frequency regions,
\item if your data is precise enough to have quantitatively accurate results.
\end{enumerate}

\subsection{Output files}\label{sec:out_files}

You can control how and where the output files are saved with the parameters in subsection OUTPUT FILES PARAMETERS of section OPTIONAL MINIMIZATION TIME PARAMETERS of \textit{OmegaMaxEnt\_input\_params.dat}.  When the minimization stage starts, the program creates two directories for the output files: \textit{OmegaMaxEnt\_output\_files} and \textit{OmegaMaxEnt\_final\_result}, which are located in ``output directory'', if this parameter is defined, else in ``input directory'' (subsection DATA PARAMETERS), if defined, or in the current directory otherwise. 

Typically, the solutions to min($\chi^2-\alpha S$) are computed for hundreds of values of $\alpha$ before the optimal spectral function is obtained. The results in a certain range above and below the optimal $\alpha$ may be useful but the rest of the results are not.  By default, in directory \textit{OmegaMaxEnt\_output\_files}, the program saves the results in a range $[10^{-r}\alpha_{opt}, 10^r\alpha_{opt}]$, where $r$ is equal to parameter \textit{save\_alpha\_range} defined in file \textit{OmegaMaxEnt\_other\_params.dat}. To define differently the range of $\alpha$ within which the results are saved, you can use parameters ``maximum alpha for which results are saved'' and ``minimum alpha for which results are saved'' in subsection OUTPUT FILES PARAMETERS.

The following files, with their respective formats, are saved in directory \textit{OmegaMaxEnt\_final\_result}:\\
\begin{small}
\begin{tabular}{>{\bfseries}p{0.55\textwidth} p{0.45\textwidth}l} %{>{\bfseries}p{8cm} p{6cm}l}
optimal\_spectral\_function\_tem\#\_alpha\#.dat & spectral function at $\alpha_{opt}$,\\
& $\omega$\qquad $A_{opt}(\omega)$\qquad (fermions),\\
& $\omega$\qquad $A_{opt}(\omega)/\omega$\qquad (bosons),\\
optimal\_spectral\_functions\_tem\#\_alpha\#\_\#\_\#.dat & spectral functions around $\alpha_{opt}$,\\
& $\omega$\qquad $A_{opt-}(\omega)$\quad $A_{opt}(\omega)$\quad $A_{opt+}(\omega)$\,,\\
& $\omega$\qquad $\sigma_{opt-}(\omega)$\quad $\sigma_{opt}(\omega)$\quad $\sigma_{opt+}(\omega)$\,,\\
G\_opt\_tem\#\_alpha\#.dat & output Green function at $\alpha_{opt}$,\\
& $\omega_n$\qquad Re[$G$]\quad Im[$G$],\\
error\_G\_opt\_tem\#\_alpha\#.dat & Normalized output error at $\alpha_{opt}$,\\
& Re[$\Delta \tilde{G}$]\qquad Im[$\Delta \tilde{G}$],\\
moments\_optimal\_spectrum\_tem\#\_alpha\#.dat & moments of the spectral function at $\alpha_{opt}$,\\
& $M_i^{in}$ \qquad $M_i^{out}$,\\
auto\_corr\_error\_G\_opt\_tem\#\_alpha\#.dat & autocorrelation of $\Delta \tilde{G}$ at $\alpha_{opt}$,\\
& $\Delta n$ \quad $AC_{Re}(\Delta n)$ \quad $AC_{Im}(\Delta n)$ (diagonal covariance)\\
& $\Delta i$ \quad $AC_{1}(\Delta i_c)$ \quad $AC_{2}(\Delta i_c)$ (general covariance)\\
Asamp\_vs\_alpha\_tem\#.dat & $A(\omega)$ at sample frequencies versus $\alpha$,\\
& $\alpha$\qquad  $A(\omega_1)$\quad $A(\omega_2)$\quad \ldots\quad$A(\omega_N)$\\
sample\_freq\_tem\#.dat & sample frequencies of file Asamp\_vs\_alpha\_tem\#.dat,\\
&$\omega_1\quad \omega_2\ldots \omega_N$
%chi2\_vs\_alpha\_tem\#.dat & $\chi^2$ versus $\alpha$,\\
%& $\alpha$\qquad $\chi^2$\,.
\end{tabular}
\end{small}

and the following files are saved in directory \textit{OmegaMaxEnt\_output\_files} :\\
\begin{small}
\begin{tabular}{>{\bfseries}p{0.55\textwidth} p{0.45\textwidth}l} %{>{\bfseries}p{8cm} p{6cm}l}
spectral\_function\_tem\#\_alpha\#.dat & spectral function at a given $\alpha$,\\
& $\omega$\qquad $A(\omega)$\qquad (fermions),\\
& $\omega$\qquad $A(\omega)/\omega$\qquad (bosons),\\
G\_out\_tem\#\_alpha\#.dat & output Green function,\\
& $\omega_n$\qquad Re[$G$]\quad Im[$G$],\\
error\_G\_out\_tem\#\_alpha\#.dat & Normalized output error,\\
& Re[$\Delta\tilde{G}$]\qquad Im[$\Delta\tilde{G}$],\\
moments\_G\_out\_tem\#\_alpha\#.dat & moments of the spectral function,\\
& $M_i^{in}$ \qquad $M_i^{out}$,\\
chi2\_vs\_alpha\_tem\#.dat & $\chi^2$ versus $\alpha$,\\
& $\alpha$\qquad $\chi^2$,\\
%Asamp\_vs\_alpha\_tem\#.dat & $A(\omega)$ at sample frequencies versus $\alpha$,\\
%& $\alpha$\qquad  $A(\omega_1)$\quad $A(\omega_2)$\quad \ldots\quad$A(\omega_N)$\,.
\end{tabular}
\end{small}

The $opt+$ and $opt-$ subscripts for the data in file \textbf{optimal\_spectral\_functions\_tem\#\_alpha\#\_\#\_\#.dat} refer to values of $\alpha$ slightly above and below $\alpha_{opt}$. Those values delimit the crossover region between \textit{information-} and \textit{noise-fitting} regimes (see also section \ref{sec:out_figs}).
\subsection{When is the calculation over}\label{sec:calc_over}

The program assumes that the calculation is over when 1) the optimal $\alpha$ has been found, and 2) the following condition is satisfied:
\begin{equation}\label{eq:stop_condition}
\text{min}\left(\frac{d\log(\chi^2)}{d\gamma\log(\alpha)}\right)<\textit{RMAX\_dlchi2\_lalpha}*\text{max}\left(\frac{d\log(\chi^2)}{d\gamma\log(\alpha)}\right)\,,
\end{equation}
where \textit{RMAX\_dlchi2\_lalpha} and $\gamma=\textit{f\_scale\_lalpha\_lchi2}$ are defined in \textit{OmegaMaxEnt\_other\_params.dat}.

You can also stop the calculation before those condition are satisfied with parameters  ``minimum value of alpha'' (subsection COMPUTATION PARAMETERS) or ``number of values of alpha computed in one execution'' (subsection MINIMIZATION EXECUTION OPTIONS). In those cases, the calculation is only paused however, as discussed in section \ref{sec:execution}, unless the two conditions above are satisfied.

%In addition, if the condition $\chi^2/N_{\chi^2}<$\textit{f\_chi2min} ($N_{\chi^2}=$ number of terms in $\chi^2$ and \textit{f\_chi2min} is defined in \textit{OmegaMaxEnt\_other\_params.dat}) is reached before the above conditions are satisfied, the program will print in the terminal that the minimum ratio of $\chi^2$ and the number of terms in it is reached, and the calculation will also stop. In that case, you have to reduce \textit{f\_chi2min} (by a few orders of magnitude at a time) to force the calculation to continue.

In any case, the calculation is not over until the lowest $\alpha$ is deep in the \textit{noise-fitting regime}. This can be determined easily from the figure of $\log\chi^2$ versus $\log\alpha$, on which you should see a plateau at high $\alpha$, an intermediate region of large slope, and a quasi-plateau (a region of very small slope) at low $\alpha$. The latter quasi-plateau should be wide enough to be sure that it is not just a smaller slope region in the \textit{information-fitting regime}. To verify that the lowest $\alpha$ is indeed in the \textit{noise-fitting} region, see that the function $\Delta\tilde{G}$ versus $\omega_n$ (or covariance eigenvector index) contains only  noise.

\subsection{How to improve the results}\label{sec:improve_results}

With the default settings, the first results you obtain with a given set of data are not the best you can obtain. This can be because the default grid is not optimal for the spectrum, or the default model needs some adjustments, or because the errors used are not accurate. The first step to improve the results is to define a grid more adapted to the spectrum using subsection FREQUENCY GRID PARAMETERS. For example, if some peaks are defined by only a few points, you can either increase the step everywhere in the main spectral region, or use a non-uniform grid, to improve the resolution of those peaks. It may also happen that the main spectral region is too narrow and not optimally aligned with the spectrum. You should adjust it so that it covers all the frequency region where the spectral weight is located. The rest of the grid should cover only the tails of the spectrum. See section \ref{sec:user-defined_grid} for more details on how to define the grid.

The default model may also be too wide, too narrow, or misaligned with the spectrum. If so, you can modify its parameters in subsection COMPUTATION OPTIONS. Note however that the default model should stay mostly featureless. The structure in the spectrum should come from the data and not from the default model.

Finally, if $\Delta\tilde{G}$ and its autocorrelation do not have the properties given in section \ref{sec:DG}, or the spectrum sample frequencies curves as a function of $\log(\alpha)$ do not have the same (quasi-)stable points (see section \ref{sec:Asamp}), then you should improve your errors if it is possible. Advices on how to improve the error are given in section section \ref{sec:DG}.

\subsection{Batch calculations}

The program can also be used to compute the spectra for large sets of data. To do so however, you need a shell script that will set automatically the parameters in file \textit{OmegaMaxEnt\_input\_params.dat}, and then launch the program. For example, you can create a version of \textit{OmegaMaxEnt\_input\_params.dat} filled with special symbols that your script will recognize and replace with parameters read from a file or generated by a loop. For each set of parameters, the script must create an input file and launch the program.

For series of calculations, the simplest way to have a good frequency grid is to set ``use non uniform grid in main spectral range'' to ``yes'' (subsection FREQUENCY GRID PARAMETERS) to let the program define a grid as well adapted to the spectrum as possible. You could also use the other options in subsection FREQUENCY GRID PARAMETERS. But in any case, you have to use grid parameters adapted to the expected spectrum. This might be difficult to do manually if the spectra are very different. Letting the program define a non uniform grid the grid automatically is probably the best option. To control how the non-uniform grid is generated, use the parameters described in section \ref{sec:user-defined_grid}.

For batch calculations, you also have to disable the interactive mode by setting ``interactive mode'' to ``no'' in subsection MINIMIZATION EXECUTION OPTIONS. This
%and disable figure plotting by setting ``show optimal alpha figures'', ``show lowest alpha figures'' and ``show alpha dependant curves'' to ``no'' in subsection DISPLAY OPTIONS. 
%Of course, the options of section PREPROCESSING EXECUTION OPTIONS cannot be used, as well as the two other options of subsection DISPLAY OPTIONS 

\section{List of input parameters}\label{sec:list_params}

The following is a complete list of the parameters defined in file \textit{OmegaMaxEnt\_input\_params.dat} with a brief description for each parameter.

\subsection{OPTIONAL PREPROCESSING TIME PARAMETERS}

\subsubsection{DATA PARAMETERS}

\begin{itemize}
\item\textit{bosonic data}

Set this parameter to ``yes'' if your data is bosonic.

\item\textit{imaginary time data}

Set this parameter to ``yes'' for imaginary time data.

\item\textit{temperature}

If only the Matsubara frequency indices are given in your data file, or if the frequencies are not very precise, you can use this parameter to provide the temperature. It must be given in energy units ($k_B=1$).

\item \textit{finite value at infinite frequency}

Set this parameter to ``yes'' if your data has a frequency-independant part, for example in the case of a self-energy, where the constant part is the Hartree-Fock term.

\item \textit{value at infinite frequency}

If your data has a frequency-independant part, but the maximum frequency is too small to extract it (smaller than the onset frequency of the asymptotic regime), use this parameter to provide that value. Make sure it is as accurate as possible. A small error can have a large impact and degrade the quality of the result.

\item\textit{norm of spectral function}

If the Green function is not normalized to 1 and you know the norm, you can use this parameter to provide it. The norm corresponds to the coefficient of $1/(i\omega_n)$ in the high frequency expansion of Matsubara functions having the spectral representation \eqref{eq:spectr_G}. It is recommended to set ``evaluate moments'' to ``yes'' (subsection COMPUTATION OPTIONS) to verify that the provided value is close to the norm extracted from your data and printed in the terminal.

If the Green function is not normalized to 1 and you \textit{do not} know the norm, see subsection \ref{sec:norm} for instructions.

The program assumes that the norm is known with relative precision \textit{err\_norm} (default value $10^{-6}$), a parameter in file \textit{OmegaMaxEnt\_other\_params.dat}. 

For real bosonic Matsubara data, the norm is 0. However, in that case, set ``Im(G) column in data file'' (subsection INPUT FILES PARAMETERS) to a value $\leq 0$ instead, and do not put anything for the norm.

\item \textit{$1^{\text{st}}$ moment}

If you know the first moment of the spectral function, use that parameter to provide it. The first moment corresponds to the coefficient of $1/(i\omega_n)^2$ in the high frequency expansion of of Matsubara functions having the spectral representation \eqref{eq:spectr_G}. It is recommended to set ``evaluate moments'' to ``yes'' (subsection COMPUTATION OPTIONS) to verify that your value is close to the one extracted from your data and printed in the terminal.

\item \textit{$1^{\text{st}}$ moment error}

If you provided the first moment, use that parameter to provide its (absolute) error. Otherwise, the value \textit{default\_error\_M}$*\Delta\omega_{std}$ will be used, where \textit{default\_error\_M} is a parameter in file \textit{OmegaMaxEnt\_other\_params.dat} and $\Delta\omega_{std}$ is the standard deviation of the spectrum.

\item \textit{$2^{\text{nd}}$ moment}

If you know the second moment of the spectral function, use that parameter to provide it. The second moment corresponds to the coefficient of $1/(i\omega_n)^3$ in the high frequency expansion of of Matsubara functions having the spectral representation \eqref{eq:spectr_G}. It is recommended to set ``evaluate moments'' to ``yes'' (subsection COMPUTATION OPTIONS) to verify that your value is close to the one extracted from your data and printed in the terminal.

\item \textit{$2^{\text{nd}}$ moment error}

If you provided the second moment, use that parameter to provide its (absolute) error. Otherwise, the value \textit{default\_error\_M}, defined in \textit{OmegaMaxEnt\_other\_params.dat}, will be used as the relative error.

\item \textit{$3^{\text{rd}}$ moment}

If you know the third moment of the spectral function, use that parameter to provide it. The third moment corresponds to the coefficient of $1/(i\omega_n)^4$ in the high frequency expansion of of Matsubara functions having the spectral representation \eqref{eq:spectr_G}. It is recommended to set ``evaluate moments'' to ``yes'' (subsection COMPUTATION OPTIONS) to verify that your value is close to the one extracted from your data and printed in the terminal.

\item \textit{$3^{\text{rd}}$ moment error}

If you provided the third moment, use that parameter to provide its (absolute) error. Otherwise, the value \textit{default\_error\_M}$*\Delta\omega_{std}^3$ will be used, where \textit{default\_error\_M} is defined in file \textit{OmegaMaxEnt\_other\_params.dat} and $\Delta\omega_{std}$ is the standard deviation of the spectrum.

\item \textit{truncation frequency}

If you notice a seemingly unstable behavior in the figures of $G_{inf}$, $M_0$ of $M_1$ (when ``evaluate moments'' and ``display preprocessing figures'' are set to ``yes'') at high fit frequency, namely, if there are some plateaus in the curves but they cease to be flat above a certain frequency $\omega_{inst}$, set that parameter to $\omega_{inst}$.

\end{itemize}

\subsubsection{INPUT FILES PARAMETERS}

\begin{itemize}

\item \textit{input directory}

If your data is not in the same directory as the program, use that parameter to set the input directory. This way, the paths are not required for parameters that are file names. The directory can be relative to the program's directory. Note that if the program does not find a file in the provided directory, it will also look for it in the current directory. This allows you to use both the current and another directory at the same time. Just remember that, if files with the same name exist in the current and the provided directory, the ones in the latter will be used.

\item \textit{Re(G) column in data file}

For Matsubara frequency data, use that parameter if the real part is not on the second column of your data file.

\item \textit{Im(G) column in data file}

For Matsubara frequency data, use that parameter if the imaginary part is not on the third column of your data file.

For the bosonic case, if the imaginary part vanishes exactly, set this parameter to a value $\leq 0$. The ``spectrum'' $\sigma(\omega)$ is then assumed to be even and only the positive part of the grid is used in the calculation.

\item \textit{error file}

Use this parameter if you have an error file where the error is given by columns. This is for the case of diagonal covariance. Otherwise, use the covariance file parameters.

\item \textit{Re(G) column in error file}
 
For Matsubara frequency data, use that parameter if an error file is provided and the error on the real part is not on the second column of the file.

\item \textit{Im(G) column in error file}

For Matsubara frequency data, use that parameter if an error file is provided and the error on the imaginary part is not on the third column of the file.

\item \textit{re-re covariance file}

For Matsubara frequency data, if you have a covariance matrix, use that parameter to provide the Re$(G)$-Re$(G)$ part of the matrix. There must be an equal number of rows and columns in the file.

\item \textit{im-im covariance file}

For Matsubara frequency data, if you have a covariance matrix, use that parameter to provide the Im$(G)$-Im$(G)$ part of the matrix. There must be an equal number of rows and columns in the file.

\item \textit{re-im covariance file}

For Matsubara frequency data, if you have a covariance matrix, use that parameter to provide the Re$(G)$-Im$(G)$ part of the matrix. There must be an equal number of rows and columns in the file.

\item \textit{column of G(tau) in data file}

For imaginary time data, use that parameter if the function value is not on the second column of your data file.

\item \textit{column of G(tau) error in error file}

For imaginary time data, if an error file is provided, use that parameter if the error is not on the second column.

\item \textit{imaginary time covariance file}

For imaginary time data, use that parameter if you have a covariance matrix.

\item \textit{added noise relative error}

If you do not know the error for your data, you can use that line to add noise of different magnitudes and see if the spectrum converges as the magnitude decreases. Provide a vector of relative standard deviation of the form ``s1 s2 ...'' and the analytic continuation will be performed for all values automatically.

\end{itemize}

\subsubsection{FREQUENCY GRID PARAMETERS}\label{sec:grid_params}

\begin{itemize}

\item \textit{Matsubara frequency cutoff}

Use this parameter to set the maximum Matsubara frequency to be used during the calculation. It is however recommended to read subsections \ref{sec:moments_extraction} and \ref{sec:provide_moments} to learn how to use it properly.

\item \textit{spectral function width}

You can use this parameter to set the width of the main spectral region, namely, the dense part of the real frequency grid.

\item \textit{spectral function center}

Use this parameter to set the center of the main spectral region.

\item \textit{real frequency grid origin}

Use this parameter to ensure the grid contains a specific frequency.

\item \textit{real frequency step}

If you are using a uniform grid in the main spectral region, you can use this parameter to set the step in that region.

\item \textit{real frequency grid file}

Use that parameter to provide a user-defined frequency grid.

\item \textit{use non uniform grid in main spectral range}

To let the program define a non-uniform frequency grid for the main spectral range, set this parameter to ``yes''.

\item \textit{use parameterized real frequency grid}

To use ``grid parameters'' on the next line, set this parameter to ``yes''.

\item \textit{grid parameters}

Use this line to provide the parameters of a non-uniform grid that will be generated by the program. The left and right boundaries will define the main spectral region.

\end{itemize}

\subsubsection{COMPUTATION OPTIONS}

\begin{itemize}

\item \textit{evaluate moments}

If you set this parameter to ``yes'', the program will try to extract the spectral function's moments from your Matsubara data. Note that, depending on the other input parameters, the moments may also be extracted even if this option is disabled.

\item \textit{maximum moment}

Use this parameter to set the maximum moment to be imposed to the spectrum. For example, to impose only the norm and the first moment, set it to 1.

\item \textit{default model center}

Use this parameter if you want the default model to be centered on a frequency different than the (normalized) first moment.

\item \textit{default model half width}

Use this parameter if you want the half width of the default model to be different from the standard deviation.

\item \textit{default model shape parameter}

Use this parameter if you want the default model to be different from a gaussian (shape parameter$=2$). A shape parameter of 1 corresponds to a Laplace distribution and, as the shape parameter increases, the default model becomes closer to a uniform distribution. A shape parameter $>1$ is recommended, so that the derivative has no singularity.

\item \textit{default model file}

Use this parameter to provide a user-defined default model.

\item \textit{initial spectral function file}

The program uses the default model as the initial spectral function. This is actually the solution when $\alpha$ is very large. However, if for some reason the program is interupted (not just paused) before the optimal result was reached, you can use this parameter and ``initial value of alpha'' (in subsection COMPUTATION PARAMETERS) to restart it at a value of $\alpha$ different from the initial one. This is useful only if the frequency grid is very large however ($N_{\omega_n}$ or $N_\omega >1000$) and the calculation time is long. For numbers of Matsubara and real frequencies in the hundreds, the calculation is fast and you will not need that option. If you do need it, it may be useful to read section \ref{sec:out_files} to learn how and where the results are saved.

\end{itemize}

\subsubsection{PREPROCESSING EXECUTION OPTIONS}

\begin{itemize}

\item \textit{preprocess only}

Set this parameter to ``yes'' to pause execution at the end of preprocessing. As long as this parameter is enabled, when resuming execution, the preprocessing stage restarts if changes were made in section OPTIONAL PREPROCESSING TIME PARAMETERS during the pause, or else nothing happens. You can disable that option during the pause to start the actual calculation.

This option, along with ``display preprocessing figures'', are very useful to verify the input parameters -- input files, frequency grid, moments, default model, etc --- and modify them if necessary, before starting the actual computation.

\item \textit{display preprocessing figures}

Set this parameter to ``yes'' to display figures during the preprocessing.

\item \textit{display advanced preprocessing figures}

Set this parameter to ``yes'' to display the ``advanced'' figures during preprocessing. Those figures show some intermediate quantities of different preprocessing operations.

\item \textit{print other parameters}

Set this parameter to ``yes'' to display the parameters of file \textit{OmegaMaxEnt\_other\_params.dat}.

\end{itemize}

\subsection{OPTIONAL MINIMIZATION TIME PARAMETERS}

\subsubsection{OUTPUT FILES PARAMETERS}\label{sec:output_files_subsec}

\begin{itemize}

\item \textit{output directory}

Use this parameter if you want to put the two output directories \textit{OmegaMaxEnt\_output\_files} and \textit{OmegaMaxEnt\_final\_result} in another directory than the one provided at ``input directory'', or the current directory otherwise.

\item \textit{output file names suffix}

Use this parameter to add a suffix to the names of the output files (see section \ref{sec:out_files}). For example, you can add parameter values specific to your data to archive your files more clearly. The suffix you define will be added after the default descriptive part of the file names, before ``tem\#''.

\item \textit{maximum alpha for which results are saved}

Use this parameter to choose the range of $\alpha$ for which the results are saved differently than how it is done by default, as described in section \ref{sec:out_files}.

\item \textit{minimum alpha for which results are saved}

Use this parameter to choose the range of $\alpha$ for which the results are saved differently than how it is done by default, as described in section \ref{sec:out_files}.

\item  \textit{spectral function sample frequencies}

Use this parameter to choose which sample frequencies of the spectrum will be plotted as a function of $\alpha$. See section \ref{sec:Asamp} for a discussion about that figure.

\end{itemize}

\subsubsection{COMPUTATION PARAMETERS}

\begin{itemize}

\item \textit{initial value of alpha}

Use this parameter only if you do not see a plateau at high $\alpha$ in the figure of $\log\chi^2$ versus $\log\alpha$. Most of the time, the value determined by the program is correct. If not, set this parameter to a value a few orders of magnitudes larger than the largest value in the figure, and increase it the same way until you see the plateau.

\item \textit{minimum value of alpha}

Use this parameter to adjust the width of the \textit{noise-fitting} region, namely the quasi-plateau at low $\alpha$ in $\log\left(\chi^2\right)$ versus $\log(\alpha)$, if necessary. This region should cover at least a few decades, to make sure that the calculation is really over, but not too many, since it is located below the optimal $\alpha$, and thus useless to the results themselves. The program is designed to make sure that this region is wide enough, so this parameter might be useful mostly to reduce the width of the \textit{noise-fitting} region.

\item \textit{maximum optimal alpha}

Use this parameter if the program does not choose the correct peak in the curvature of $\log\chi^2$ versus $\log\alpha$, namely, the peak located in the crossover region between the \textit{information-} and \textit{noise-fitting} ranges of $\alpha$. See subsection \ref{sec:find_alpha_opt} for a discussion about this topic.

\item \textit{minimum optimal alpha}

Use this parameter to ignore the peaks below a certain $\alpha$ in the curvature of $\log\chi^2$ versus $\log\alpha$, in case there are more than one peak in the region where the optimal $\alpha$ should be chosen.  

\end{itemize}

%In this section you can set the initial and minimum values of $\alpha$. The values estimated by the program are usually reasonable. It may however happen that the initial value is not large enough, so that the solution is not close enough to the default model (the default initial spectral function). This is not desirable since the minimization algorithm assumes that the solution at a given value of $\alpha$ is only slightly different from the solution at the previous $\alpha$. A too large estimate for the inital $\alpha$ is also possible. In that case the calculation may take an unnecessary large amount of time. The minimum $\alpha$ may also be over- or underestimated by the program. Changing ``initial value of alpha'' during a pause of the program (see section \ref{sec:exec_opt}) will restart the calculation at the new value (without preprocessing).

%To choose the region where the program locates the peak in the curvature of $\log\left(\chi^2\right)$ versus $\log\left(\alpha\right)$ corresponding to the optimal $\alpha$, you can set the parameters ``maximum optimal alpha'' and ``minimum optimal alpha''.

%Our minimization routine is fast and has not failed so far. But in case it does, you can tell the program to use the Matlab routine \textit{fmincon} to perform the minimization by setting ``use fmincon'' to ``yes''. Although a robust routine, it is extremely slow compared to our routine, so hopefully you will not have to use it. 

\subsubsection{MINIMIZATION EXECUTION OPTIONS}\label{sec:exec_opt}

\begin{itemize}

\item \textit{number of values of alpha computed in one execution}

Use this parameter to force a pause once the spectrum has been computed for a certain number of values of $\alpha$. The program will display figures showing the results at the current stage of the calculation. You can make some changes in section OPTIONAL MINIMIZATION TIME PARAMETERS without triggering the preprocessing, except for option ``initialize preprocessing''. Once you have closed the figures, the program will ask you if you want to continue the execution. If you do, computation will resume at the point it halted.

\item \textit{initialize maxent}

Use this option to restart the minimization stage at the initial value of $\alpha$ after a pause. Do not forget to disable that option if the execution is paused again before the calculation is over and you modify the file \textit{OmegaMaxEnt\_input\_params.dat} during the pause, unless you want the minimization stage to start over again.

Note that if you modify either ``output directory'', ``spectral function sample frequencies'' or ``initial value of alpha'' during a pause, the minimization stage will also start over.

\item \textit{initialize preprocessing}

Use this option if you want to restart the preprocessing. Note that if you make modifications in section OPTIONAL PREPROCESSING TIME PARAMETERS, the preprocessing will also restart.

\item \textit{interactive mode}

To disable interactive mode, set this parameter to ``no''. The program will then execute once and quit. No figures are displayed in this mode.

\end{itemize}

\subsubsection{DISPLAY OPTIONS}

\begin{itemize}

\item \textit{display results at each value of alpha}

If that option is enabled, the values of $Q=\chi^2-\alpha S$, $S$ and $\chi^2$ will be printed in the terminal at each value of $\alpha$ computed.

\item \textit{show optimal alpha figures}

Use this parameter if you \textit{do not} want the program to display the figures corresponding to the \textit{optimal} $\alpha$.

\item \textit{show lowest alpha figures}

Use this parameter if you \textit{do not} want the program to display the figures corresponding to the \textit{lowest} $\alpha$.

\item \textit{show alpha dependant curves}

Use this parameter if you \textit{do not} want the program to display the $\alpha$-dependant curves, namely, $\log\left(\chi^2\right)$ vs $\log(\alpha)$, its curvature, and the spectrum sample frequencies vs $\log(\alpha)$.

\item \textit{reference spectral function file}

You can use that parameter to provide a reference spectrum that will be plotted on the same figures as the spectrum.

\end{itemize}

%You can tell the program to print all values of $\alpha$, $Q=\chi^2-\alpha S$ and $\chi^2$ on screen by setting ``print alpha results'' to ``yes''.

%To see some figures showing the progression of the minimization, set ``display minimization figures'' to ``yes''.

%To add a spectral function on the same figure as the computed spectral function, set the parameter ``test spectral function file''. 

\appendix

%\section{List of parameters in file \textit{OmegaMaxEnt\_other\_params.dat}}
%\begin{itemize}
%\item Nn_max
%\end{itemize}

\section{How the program estimates the width of a low energy peak}\label{sec:peak_width}

When the spectrum has low energy peak well isolated from the rest of the spectrum, its weight, position, and width are obtained with good accuracy from the coefficients of a Laurent series fitted to the low frequency part of $G(i\omega_n)$. When a narrow low energy peak is present, but other structures are also present at low energy, the Laurent series approximation is not strictly valid anymore. However, the fit is often good anyway and the peak width determined from it has the correct order of magnitude, which is very useful to define the step at low frequency. The program therefore systematically tries to make the Laurent series fit and uses the width obtained when the quality of the fit is acceptable. The parameters \textit{std\_norm\_peak\_max}, \textit{varM2\_peak\_max} and \textit{peak\_weight\_min}, all defined in file \textit{OmegaMaxEnt\_other\_params.dat}, are used to determine if the quality of the fit sufficient to take the result into account. The parameter \textit{R\_peak\_width\_dw}, also defined in \textit{OmegaMaxEnt\_other\_params.dat}, defines the ratio of the peak width and the step at $\omega=0$. 

%The presence of a peak in the spectrum at low energy produces a specific signature in the Matsubara data. For fermions, the imaginary part will seem divergent at low frequency, while for bosons, it produces a jump in the real part at low frequency. In addition, if that peak is isolated enough from the rest of the spectrum one can obtain its weight, position, and width from the coefficients of a Laurent series fitted to the low frequency part of $G(i\omega_n)$. When the signature of the presence of a well defined peak at low energy is detected by the program, it performs that fit and print the three values in the terminal if the fit is good. The parameters \textit{Nwn\_test\_metal}, \textit{R\_d2G\_chi\_peak}, \textit{std\_norm\_peak\_max} and \textit{varM2\_peak\_max}, all defined in file \textit{OmegaMaxEnt\_other\_params.dat}, are used to determine if the fit is performed and, if so, if it is good enough to take the result into account. The only parameter actually used by the program is the width, which provides an order of magnitude for the step that should be used in the low frequency part of the grid.

\section{Other parameters}\label{sec:list_other_params}

The following is a complete list of the parameters defined in file \textit{OmegaMaxEnt\_other\_params.dat}.

\begin{itemize}

\item \textit{Nn\_min}

Minimum number of Matsubara frequencies. Minimum number of Matsubara frequencies used in $\chi^2$, if that number is smaller than the total number of frequencies provided.

\item \textit{Nn\_max}

Maximum number of Matsubara frequencies. Once the asymptotic part has been removed, if the number of frequencies exceeds that value, a non-uniform Matsubara grid will be used.

\item \textit{Nw\_min}

Minimum number of real frequencies. 

\item \textit{Nw\_max}

Maximum number of real frequencies. The execution is paused and cannot continue if the number of frequencies exceeds that number. If that happens, you can either increase that value, or use parameters of subsection FREQUENCY GRID PARAMETERS in file \textit{OmegaMaxEnt\_input\_params.dat} to modify the grid. The latter option is more efficient and thus recommended.

\item \textit{Nn\_fit\_max}

During computation of the moments, maximum number of frequencies used in the fit of the asymptotic form of the Matsubara function when localizing the asymptotic part of the function.

\item \textit{Nn\_fit\_fin}

During computation of the moments, maximum number of frequencies used in the final fit of the asymptotic form of the Matsubara function.

\item \textit{Nn\_as\_min}

Minimum number of frequencies required in the asymptotic region for the computed moments to be used in the calculation.

\item \textit{Niter\_dA\_max}

Maximum number of iterations in the calculation of the spectrum at a given value of $\alpha$ using Newton's method to solve $\nabla Q=0$.

\item \textit{Nwsamp}

Default number of sample frequencies of the spectral function to be plotted (and saved) as a function of alpha.

\item \textit{Nsmooth\_errG}

Smoothing distance for the added noise error. When using parameter ``added noise relative error'' in section INPUT FILES PARAMETERS, the error can be smoothed after it has been defined as a constant times the absolute value of the data. ``Nsmooth\_errG'' is the number of frequencies used on each side of a given frequency used in the smoothing.

\item \textit{f\_SW\_std\_omega}

Ratio of main spectral range and standard deviation of spectrum.

\item \textit{f\_w\_range}

Ratio of the total real frequency range and the main spectral range.

\item \textit{Rmin\_SW\_dw}

Minimum ratio of standard deviation of spectrum and frequency step.

\item \textit{tol\_Ginf}

Tolerance on frequency-independant part of data. When ``value at infinite frequency'' is set, if the ratio of the residual frequency-independant value extracted from the high-frequency part of the data (at the same time as the moments) and the provided value is larger than \textit{tol\_Ginf}, a warning is printed in the standard output.

\item \textit{tol\_tem}

Tolerance on the relative difference between the temperature extracted from the first finite Matsubara frequency and the input temperature. A warning is given if that tolerance is exceeded.

\item \textit{tol\_norm}, 

Tolerance on the difference between the norm extracted from the asymptotic part of the data and the provided norm (if applicable). A warning is given if that tolerance is exceeded.

\item \textit{tol\_M1}

Tolerance on the difference between the first moment extracted from the asymptotic part of the data and the provided one (if applicable). A warning is given if that tolerance is exceeded.

\item \textit{tol\_M2}

Tolerance on the difference between the second moment extracted from the asymptotic part of the data and the provided one (if applicable). A warning is given if that tolerance is exceeded.

\item \textit{tol\_M3}

Tolerance on the difference between the third moment extracted from the asymptotic part of the data and the provided one (if applicable). A warning is given if that tolerance is exceeded.

\item \textit{default\_error\_G}

Default error on the input data. When no error file is provided, a constant error of \textit{default\_error\_G}$*G_{max}$ is used, where $G_{max}$ is the maximum absolute value of the imaginary part of the data, for fermions, or the real part, for bosons.

\item \textit{err\_norm}

Relative error on norm.

\item \textit{default\_error\_M}

Default error on moments.

\item \textit{tol\_mean\_C1}

Tolerance used to find the onset of the asymptotic region of $G$ from the fitted norm as a function of the starting frequency of the fit.

\item \textit{tol\_std\_C1}

Tolerance used to find the onset of the asymptotic region of $G$ from the standard deviation of the fitted norm as a function of the starting frequency of the fit.

\item \textit{tol\_rdw}

Tolerance used to decide if consecutive frequency intervals are equal. Used to detect if a frequency grid has been generated by the program.

\item \textit{Rmin\_Dw\_dw}

Minimum number of steps accepted in a grid interval when using a parameterized real frequency grid (``grid parameters'' in subsection FREQUENCY GRID PARAMETERS of file \textit{OmegaMaxEnt\_input\_params.dat}).

\item \textit{Rdw\_max}

Maximum ratio of steps recommended in consecutive grid interval when using a parameterized real frequency grid (``grid parameters'').

\item \textit{RW\_grid}

Ratio of grid interval length and the transition region between intervals in the parameterized real frequency grid.

\item \textit{RWD\_grid}

Width of the transition region of the hyperbolic tangent used to define the parameterized real frequency grid.

\item \textit{minDefM}

Minimum value of default model.

\item \textit{f\_alpha\_init}

Initial ratio of the entropy and the $\chi^2$ contributions to the spectrum.

\item \textit{R\_width\_ASmin}

Width of the minimum entropy spectrum peaks relative to the width of the default model.

\item \textit{f\_Smin}

Ratio of the minimum entropy and the optimal $\chi^2$. Used to estimate $\alpha_{min}$ during the preprocessing.

\item \textit{diff\_chi2\_max}
 
Maximum relative difference between the $\chi^2$ of consecutive values of $\alpha$. If this ratio is exceeded, the step in $\log_{10}(\alpha)$ is decreased.

\item \textit{tol\_int\_dA}

Tolerance on consecutive values of the integral of $|\delta A|$, where $\delta A$ is the variation in the spectrum $A$ between iterations in the Newton's method used to compute the spectrum.

\item \textit{rc2H}

Maximum ratio of the penalization parameter and the maximum eigenvalue of the hessian of $\chi^2$. The penalization parameter is used to avoid negative values of the spectrum.

\item \textit{fc2}

Ratio of the default model and the minimum of the penalization function, which prevents the spectrum from becoming negative.

\item \textit{pow\_alpha\_step\_init}

Initial value of the step in $\log_{10}(\alpha)$.

\item \textit{pow\_alpha\_step\_min}

Minimal value of the step in $\log_{10}(\alpha)$.

\item \textit{chi2\_alpha\_smooth\_range}

Length of the part of the curve $\log_{10}\left(\chi^2\right)$ vs $\gamma\log_{10}(\alpha)$ used to compute its local curvature. $\gamma$ is the parameter \textit{f\_scale\_lalpha\_lchi2}.

\item \textit{f\_scale\_lalpha\_lchi2}

$\gamma$ in the calculation of the curvature of $\log_{10}(\chi^2)$ vs $\gamma\log_{10}(\alpha)$.

\item \textit{FNfitTauW}

Factor that determines the number of values of $\tau$ used in the polynomial fit in the calculation of the moments from imaginary time data.

\item \textit{std\_norm\_peak\_max}

For fermions, tolerance on the standard deviation of the low frequency peak weight as a function of fitting power in the estimation of a low frequency peak width. Used to decide if there is a well defined peak or not.

\item \textit{varM2\_peak\_max}

For bosons, relative tolerance on the low frequency peak variance as a function of fitting power in the estimation of a low frequency peak width. Used to decide if there is a well defined peak or not.

\item \textit{peak\_weight\_min}

Minimum value of peak weight to assume a low energy peak is present.

\item \textit{RMAX\_dlchi2\_lalpha}

Maximum ratio of $d\log\left(\chi^2\right)/d\log(\alpha)$ at the lowest $\alpha$, and the maximum value. Used to determine if $\alpha$ is deep enough in the \textit{noise-fitting} region.

\item \textit{f\_alpha\_min}

Factor by which $\alpha_{min}$ is reduced when estimated to be too high.

\item \textit{save\_alpha\_range}

Range of $\alpha$ above and below the optimal value for which the results are saved, in $\log_{10}$ scale. If $r=$\textit{save\_alpha\_range}, the range saved is $[10^{-r}\alpha_{opt}, 10^r\alpha_{opt}]$. 

\item \textit{R\_peak\_width\_dw}

When a low energy peak is detected and parameter ``use non uniform grid in main spectral range'' is set to ``yes'' (subsection FREQUENCY GRID PARAMETERS), this parameter is the ratio of the peak width and the frequency grid step around $\omega=0$.

\item \textit{R\_wncutoff\_wr}

When ``use non uniform grid in main spectral range'' is set to ``yes'' (subsection FREQUENCY GRID PARAMETERS), this is the ratio of the onset Matsubara frequency of the asymptotic region of the Green function and the main spectral range maximum frequency absolute value.

\item \textit{R\_Dw\_dw}

When ``use non uniform grid in main spectral range'' is set to ``yes'' (subsection FREQUENCY GRID PARAMETERS), this is the ratio of a grid interval's length and its step.

\item \textit{R\_SW\_wr}

When ``use non uniform grid in main spectral range'' is set to ``yes'' (subsection FREQUENCY GRID PARAMETERS), but the onset Matsubara frequency of the asymptotic region of the Green function is unknown (the moments have not been extracted from the data), this is the ratio of the main spectral range and the standard deviation of the spectrum (if moments were provided).

\item \textit{R\_wmax\_wr\_min}

When ``use non uniform grid in main spectral range'' is set to ``yes'' (subsection FREQUENCY GRID PARAMETERS), this is the minimum ratio of the grid maximum frequency and the main spectral range maximum frequency.

\item \textit{wgt\_min\_sm}

Smallest relative weight in the smoothing of the added noise error. Relative weight at the distance ``Nsmooth\_errG'' from a given frequency during smoothing of the added noise error.

\end{itemize}

\section{Analytic continuation for spectral functions with non-definite sign}\label{sec:non_def_sign_sf}

Given a correlation function
\begin{equation}
C_{AB}(\tau)=-\mn{T_{\tau} A(\tau)B}\,,
\end{equation}
or its Fourier transform $C_{AB}(i\omega_n)$, analytic continuation of that function using the maximum entropy method can be done \textit{directly} only for spectral functions with the property 
\begin{equation}\label{eq:positivity_fermions_1}
Im[C_{AB}^R(\omega)]<0\,,
\end{equation}
if $A$ and $B$ are fermion operators, or
\begin{equation}\label{eq:positivity_bosons_1}
\frac{Im[C_{AB}^R(\omega)]}{\omega}<0\,,
\end{equation}
if $A$ and $B$ are boson operators. 

However, if $Im[C_{AB}^R(\omega)]$ does not satisfy that property, it can still be obtained with a MaxEnt routine, but only \textit{indirectly} in that case. The procedure to to do so is the following:

First, we define
\begin{equation}
\begin{split}
O&=A+\mu B^\dagger\,,\\\
P&=A+i\nu B^\dagger\,.
\end{split}
\end{equation}
where $\mu$ and $\nu$ are real scalars such that $\mu B$ and $\nu B$ have the same dimension as $A$ and which values are assumed arbitrary in the present demonstration. Thus,
\begin{equation}
\begin{split}
C_{OO^\dagger}(\tau)%&=-\mn{T_{\tau} O(\tau)O^\dagger}\,,\\
&=-\mn{T_{\tau} (A+\mu B^\dagger)(\tau)(A+\mu B^\dagger)^\dagger}\\
&=-\mn{T_{\tau} (A+\mu B^\dagger)(\tau)(A^\dagger+\mu B)}\\
&=-\mn{T_{\tau} A(\tau)A^\dagger} -\mu\mn{T_{\tau}A(\tau)B}-\mu\mn{B^\dagger(\tau)A^\dagger}-\mu^2\mn{T_{\tau}B^\dagger(\tau)B}\\
C_{OO^\dagger}(\tau)&=C_{AA^\dagger}(\tau)+\mu C_{AB}(\tau)+\mu C_{B^\dagger A^\dagger}(\tau)+\mu^2 C_{B^\dagger B}(\tau)\,,
\end{split}\label{eq:def_COO}
\end{equation}
%\begin{equation}
%C_{OO^\dagger}(i\omega_n)=C_{AA^\dagger}(i\omega_n)+\mu C_{AB}(i\omega_n)+\mu C_{B^\dagger A^\dagger}(i\omega_n)+\mu^2 C_{B^\dagger B}(i\omega_n)\,,
%\end{equation}
and
\begin{equation}
\begin{split}
C_{PP^\dagger}(\tau)%&=-\mn{T_{\tau} P(\tau)P^\dagger}\,,\\
&=-\mn{T_{\tau} (A+i\nu B^\dagger)(\tau)(A+i\nu B^\dagger)^\dagger}\,,\\
&=-\mn{T_{\tau} (A+i\nu B^\dagger)(\tau)(A^\dagger-i\nu B)}\,,\\
&=-\mn{T_{\tau} A(\tau)A^\dagger} +i\nu\mn{T_{\tau}A(\tau)B}-i\nu\mn{B^\dagger(\tau)A^\dagger}-\nu^2\mn{T_{\tau}B^\dagger(\tau)B}\\
C_{PP^\dagger}(\tau)&=C_{AA^\dagger}(\tau) -i\nu C_{AB}(\tau)+i\nu C_{B^\dagger A^\dagger}(\tau)+\nu^2C_{B^\dagger B}(\tau)\,.
\end{split}\label{eq:def_CPP}
\end{equation}
Now, if we define
\begin{equation}
\begin{split}
%R(\tau)&=C_{OO^\dagger}(\tau)+\mn{T_{\tau} A(\tau)A^\dagger}+\mu^2\mn{T_{\tau}B^\dagger(\tau)B}\\
R(\tau)&=C_{OO^\dagger}(\tau)-C_{AA^\dagger}(\tau)-\mu^2C_{B^\dagger B}(\tau)\\
&=\mu\left[C_{AB}(\tau)+C_{B^\dagger A^\dagger}(\tau)\right]
\end{split}\label{eq:R_tau}
\end{equation}
and
\begin{equation}
\begin{split}
%S(\tau)&=C_{PP^\dagger}(\tau)+\mn{T_{\tau} A(\tau)A^\dagger}+\nu^2\mn{T_{\tau}B^\dagger(\tau)B}\\
S(\tau)&=C_{PP^\dagger}(\tau)-C_{AA^\dagger}(\tau)-\nu^2C_{B^\dagger B}(\tau)\\
&=-i\nu\left[C_{AB}(\tau)-C_{B^\dagger A^\dagger}(\tau)\right]\,,
\end{split}\label{eq:S_tau}
\end{equation}
we have
\begin{equation}
C_{AB}(\tau)=\frac{1}{2}\left[\frac{1}{\mu}R(\tau)+i\frac{1}{\nu}S(\tau)\right]
\end{equation}
or
\begin{equation}
C_{AB}(i\omega_n)=\frac{1}{2}\left[\frac{1}{\mu}R(i\omega_n)+i\frac{1}{\nu}S(i\omega_n)\right]
\end{equation}
and thus
\begin{equation}
C_{AB}^R(\omega)=\frac{1}{2}\left[\frac{1}{\mu}R^R(\omega)+i\frac{1}{\nu}S^R(\omega)\right]\,.
\end{equation}
Therefore,
\begin{equation}\label{eq:Im_C_AB}
Im[C_{AB}^R(\omega)]=\frac{1}{2}\left[\frac{1}{\mu}Im[R^R(\omega)]+\frac{1}{\nu}Re[S^R(\omega)]\right]\,,
\end{equation}
where, from \eqref{eq:R_tau} and \eqref{eq:S_tau},
\begin{equation}\label{eq:R_R_omega}
R^R(\omega)=C_{OO^\dagger}^R(\omega)-C_{AA^\dagger}^R(\omega)-\mu^2C_{B^\dagger B}^R(\omega)\\
\end{equation}
and
\begin{equation}\label{eq:S_R_omega}
S^R(\omega)=C_{PP^\dagger}^R(\omega)-C_{AA^\dagger}^R(\omega)-\nu^2C_{B^\dagger B}^R(\omega)\,.
\end{equation}

Now, the right-hand sides of \eqref{eq:R_tau} and \eqref{eq:S_tau} contain only correlation functions that satisfy property \eqref{eq:positivity_fermions_1} or \eqref{eq:positivity_bosons_1} (see Appendix \ref{sec:definite_sign_sf} for the proof)  and can thus be treated directly with a MaxEnt routine. To obtain $Im[R^R(\omega)]$, it suffices to obtain $Im[C_{OO^\dagger}^R(\omega)]$, $Im[C_{AA^\dagger}(\omega)]$ and $Im[C_{B^\dagger B}(\omega)]$ separately with the MaxEnt routine and then use \eqref{eq:R_R_omega}. If the correlation function has the property $C_{AB}(\tau)=C_{B^\dagger A^\dagger}(\tau)$, then $S(\tau)=0$ and the problem is solved. Otherwise, to obtain $Re[S^R(\omega)]$ in \eqref{eq:Im_C_AB} using \eqref{eq:S_R_omega}, we need $Re[C_{PP^\dagger}(\omega)]$, $Re[C_{AA^\dagger}(\omega)]$ and $Re[C_{B^\dagger B}(\omega)]$. Those functions can be computed using the Kramers-Kr\"onig relation:
\begin{equation}
Re[C_{AB}^R(\omega)]=\mathcal{P}\int \frac{d\omega'}{\pi} \frac{Im[C_{AB}^R(\omega)]}{\omega'-\omega}\,,
\end{equation}
once the imaginary parts have been computed with the MaxEnt routine. Therefore, all functions necessary to obtain $Im[C_{AB}^R(\omega)]$ can be obtained with a maximum entropy routine and a Kramers-Kr\"onig relation.

To summarize, the steps to obtain $Im[C_{AB}^R(\omega)]$ are
\begin{enumerate}
\item Compute $C_{AB}(\tau)$, $C_{B^\dagger A^\dagger}(\tau)$, $C_{AA^\dagger}(\tau)$ and $C_{B^\dagger B}(\tau)$, or their Matsubara frequency counterparts
\item Define the parameters $\mu$ and $\nu$ and compute $C_{OO^\dagger}(\tau)$, given by \eqref{eq:def_COO} and $C_{PP^\dagger}(\tau)$, given by \eqref{eq:def_CPP}, or their Matsubara frequency counterparts
\item Use a maximum entropy routine to compute $Im[C_{OO^\dagger}^R(\omega)]$, $Im[C_{PP^\dagger}(\omega)]$ \big(if $C_{AB}(\tau)\neq C_{B^\dagger A^\dagger}(\tau)$\big), $Im[C_{AA^\dagger}(\omega)]$ and $Im[C_{B^\dagger B}(\omega)]$
\item If $C_{AB}(\tau)\neq C_{B^\dagger A^\dagger}(\tau)$, use the appropriate Kramers-Kr\"onig relation to obtain $Re[C_{PP^\dagger}(\omega)]$, $Re[C_{AA^\dagger}(\omega)]$ and $Re[C_{B^\dagger B}(\omega)]$
\item Compute $Im[C_{AB}^R(\omega)]$ with \eqref{eq:Im_C_AB}, \eqref{eq:R_R_omega} and \eqref{eq:S_R_omega}
\end{enumerate}

In practice, the stability of the result will depend on the values of $\mu$ and $\nu$. Those values must therefore be varied to find a region of the $(\mu,\nu)$ space where the result is stable \cite{Reymbaut:2015}.

This method was originally published in Ref. \cite{Reymbaut:2015}, including an example of application on the calculation of the ``anomalous'' part of the Green function in superconductivity. Another example of application on the calculation of thermoelectric (Seebeck) response functions can be found in Ref. \cite{Reymbaut_Gagnon_2017}.

\section{Spectral function with definite sign}\label{sec:definite_sign_sf}

The spectral function $Im[C_{AA^\dagger}^R(\omega)]$ associated with a correlation function of the form
\begin{equation}
C_{AA^\dagger}(\tau)=-\mn{T_{\tau} A(\tau)A^\dagger}
\end{equation}
has the property
\begin{equation}\label{eq:positivity_fermions}
Im[C_{AA^\dagger}^R(\omega)]<0\,,
\end{equation}
if $A$ is a fermion operator, or
\begin{equation}\label{eq:positivity_bosons}
\frac{Im[C_{AA^\dagger}^R(\omega)]}{\omega}<0\,,
\end{equation}
if $A$ is a boson operator.

\textit{Proof:}

Let us assume $0<\tau<\beta$. If $\ket{i}$ are eigenstates of $H$, then
\begin{equation}
\begin{split}
C_{AA^\dagger}(\tau)&=-\frac{1}{Z}\sum_i\bra{i}e^{-\beta H}e^{\tau H}Ae^{-\tau H}A^\dagger\ket{i}\\
&=-\frac{1}{Z}\sum_{ij}\bra{i}e^{-\beta H}e^{\tau H}Ae^{-\tau H}\ket{j}\bra{j}A^\dagger\ket{i}\\
&=-\frac{1}{Z}\sum_{ij}e^{-\beta E_i}e^{\tau \left(E_i-E_j\right)}\bra{i}A\ket{j}\bra{j}A^\dagger\ket{i}\\
&=-\frac{1}{Z}\sum_{ij}e^{-\beta E_i}e^{\tau \left(E_i-E_j\right)}\left|\bra{i}A\ket{j}\right|^2\,,
\end{split}
\end{equation}
where
\begin{equation}
Z=\sum_i\bra{i}e^{-\beta H}\ket{i}=\sum_ie^{-\beta E_i}\,.
\end{equation}

If $A$ is bosonic, $C_{AA^\dagger}(\tau)$ is periodic in $\tau$, with period $\beta$, and if $A$ is fermionic, $C_{AA^\dagger}(\tau)$ is antiperiodic, i.e., $C_{AA^\dagger}(\tau+\beta)=-C_{AA^\dagger}(\tau)$. Taking into account the (anti-)periodicity, the Fourier transform of $C_{AA^\dagger}(\tau)$ is
\begin{equation}
\begin{split}
C_{AA^\dagger}(i\omega_n)&=-\frac{1}{Z}\sum_{ij}e^{-\beta E_i}\left|\bra{i}A\ket{j}\right|^2\int_{0}^\beta d\tau e^{i\omega_n\tau}e^{\tau \left(E_i-E_j\right)}\\
&=-\frac{1}{Z}\sum_{ij}\frac{\left|\bra{i}A\ket{j}\right|^2}{i\omega_n+E_i-E_j}e^{-\beta E_i}\left(e^{i\omega_n\beta}e^{\beta\left(E_i-E_j\right)}-1\right)\\
&=-\frac{1}{Z}\sum_{ij}\frac{\left|\bra{i}A\ket{j}\right|^2}{i\omega_n+E_i-E_j}\left(\pm e^{-\beta E_j}-e^{-\beta E_i}\right)\\
\end{split}
\end{equation}
where $\omega_n=2n\pi T$ and we use the $+$ for bosons and $\omega_n=(2n+1)\pi T$ and we use the $-$ for fermions. Now the retarded correlation function is
\begin{equation}
C_{AA^\dagger}^R(\omega)=-\lim_{\eta\rightarrow 0^+}\frac{1}{Z}\sum_{ij}\frac{\left|\bra{i}A\ket{j}\right|^2}{\omega+i\eta+E_i-E_j}\left(\pm e^{-\beta E_j}-e^{-\beta E_i}\right)\\
\end{equation}
and thus,
\begin{equation}
Im[C_{AA^\dagger}^R(\omega)]=\frac{\pi}{Z}\sum_{ij}\left|\bra{i}A\ket{j}\right|^2\left(\pm e^{-\beta E_j}-e^{-\beta E_i}\right)\delta(\omega+E_i-E_j)\,.
\end{equation}

Therefore,
\begin{equation}
Im[C_{AA^\dagger}^R(\omega)]<0\,,\qquad fermions\\\,,
\end{equation}
\begin{equation}
Im[C_{AA^\dagger}^R(\omega)]
\begin{cases}
<0\,,\quad\omega>0\\
>0\,,\quad\omega<0\\
\end{cases},\qquad bosons
\end{equation}
i.e.
\begin{equation}
\frac{Im[C_{AA^\dagger}^R(\omega)]}{\omega}<0\,,\qquad bosons.
\end{equation}

\bibliographystyle{plain}
\bibliography{tout2013}

\end{document}

